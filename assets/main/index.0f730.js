window.__require=function e(t,n,r){function o(c,s){if(!n[c]){if(!t[c]){var u=c.split("/");if(u=u[u.length-1],!t[u]){var a="function"==typeof __require&&__require;if(!s&&a)return a(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+c+"'")}c=u}var l=n[c]={exports:{}};t[c][0].call(l.exports,function(e){return o(t[c][1][e]||e)},l,l.exports,e,t,n,r)}return n[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<r.length;c++)o(r[c]);return o}({AssetLoader:[function(e,t,n){"use strict";cc._RF.push(t,"bd285a4GGZOmKCJAp9Nfndj","AssetLoader");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.FolderLoader=n.BundleLoader=n.SingleLoader=n.AssetLoader=void 0;var i=function(){function e(){}return e.parse=function(e){var t=e.split("/?");if(t.length>1){var n=t[1].split("=");return{path:t[0],bundle:n[1]}}return{path:t[0]}},e.combine=function(e,t){return e+(t?"/?bundle="+t:"")},e}();n.AssetLoader=i;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.execute=function(e,t){return new Promise(function(n,r){var o=i.parse(e),c=o.path,s=o.bundle;(s?cc.assetManager.getBundle(s):cc.resources).load(c,t,function(e,t){return e?r(e):n(t)})})},t}(i);n.SingleLoader=c;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.execute=function(e){return new Promise(function(t,n){cc.assetManager.loadBundle(e,function(e,r){return e?n(e):t(r)})})},t}(i);n.BundleLoader=s;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.execute=function(e,t){return new Promise(function(n,r){var o=i.parse(e),c=o.path,s=o.bundle,u=s?cc.assetManager.getBundle(s):cc.resources;u.loadDir(c,t,function(e,o){e&&r(e);var a=u.getDirWithPath(c,t),l=[];o.forEach(function(e,t){l.push({url:i.combine(a[t].path,s),asset:e})}),n(l)})})},t}(i);n.FolderLoader=u,cc._RF.pop()},{}],AssetMgr:[function(e,t,n){"use strict";cc._RF.push(t,"4fba7nXle5NQbOyTjNwXFtj","AssetMgr");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.AssetMgr=void 0;var s=e("../util/Singleton"),u=e("./AssetLoader"),a=function(e){function t(){var t=e.call(this)||this;return t._bundles=new Map,t._assets=new Map,t._loaders={},t._loaders.single=new u.SingleLoader,t._loaders.bundle=new u.BundleLoader,t._loaders.folder=new u.FolderLoader,t}return o(t,e),Object.defineProperty(t.prototype,"_now",{get:function(){return Date.now()/1e3},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_dateline",{get:function(){return this._now+t.IDLE},enumerable:!1,configurable:!0}),t.prototype.onDestroy=function(){this._loaders.single=null,this._loaders.bundle=null,this._loaders.folder=null,this._assets.forEach(function(e){return e.asset.decRef()}),this._assets.clear(),this._bundles.forEach(function(e){e.releaseAll(),cc.assetManager.removeBundle(e)}),this._bundles.clear()},t.prototype.get=function(e){var t=this._assets.get(e);return t?(t.time=this._dateline,t.asset):null},t.prototype.add=function(e,t,n){return!(!t||0!=this._assets.has(e)||(this._assets.set(e,{asset:t,time:this._dateline,reserve:n}),t.addRef(),0))},t.prototype.clear=function(){var e=this,t=[];this._assets.forEach(function(n,r){n.time<e._now&&0==n.reserve&&(t.push(r),n.asset.decRef())},this),t.forEach(function(t){return e._assets.delete(t)},this)},t.prototype.loadAsset=function(e,t,n){return i(this,void 0,Promise,function(){var r,o;return c(this,function(i){switch(i.label){case 0:return 0!=this._assets.has(e)?[3,3]:[4,this.loadBundle(e)];case 1:return i.sent(),r=this.add,o=[e],[4,this._loaders.single.execute(e,t)];case 2:r.apply(this,o.concat([i.sent(),n])),i.label=3;case 3:return[2,this.get(e)]}})})},t.prototype.loadFolder=function(e,t,n){return i(this,void 0,Promise,function(){var r=this;return c(this,function(o){switch(o.label){case 0:return[4,this.loadBundle(e)];case 1:return o.sent(),[4,this._loaders.folder.execute(e,t)];case 2:return o.sent().forEach(function(e){return r.add(e.url,e.asset,n)},this),[2]}})})},t.prototype.loadBundle=function(e){return i(this,void 0,Promise,function(){var t,n,r,o,i;return c(this,function(c){switch(c.label){case 0:return 0!=this._bundles.has(e)?[3,2]:((t=u.AssetLoader.parse(e)).path,(n=t.bundle)?(o=(r=this._bundles).set,i=[e],[4,this._loaders.bundle.execute(n)]):[3,2]);case 1:o.apply(r,i.concat([c.sent()])),c.label=2;case 2:return[2]}})})},t.IDLE=300,t}(s.Singleton);n.AssetMgr=a,cc._RF.pop()},{"../util/Singleton":"Singleton","./AssetLoader":"AssetLoader"}],AudioCfg:[function(e,t,n){"use strict";cc._RF.push(t,"badfe6dZDFF2ICvAarYFyR4","AudioCfg"),Object.defineProperty(n,"__esModule",{value:!0}),n.AudioSrc=void 0,function(e){e.Opening="opening/?bundle=audio",e.LoopBgm="bgm/?bundle=audio",e.Begin="sfx-3/?bundle=audio",e.Win="sfx-2/?bundle=audio",e.Lose="sfx-4/?bundle=audio",e.Rule="sfx-1/?bundle=audio",e.Select="sfx-select/?bundle=audio",e.Crush="sfx-crush/?bundle=audio",e.Hit="sfx-hit/?bundle=audio",e.Dead="sfx-dead/?bundle=audio"}(n.AudioSrc||(n.AudioSrc={})),cc._RF.pop()},{}],BgmAudio:[function(e,t,n){"use strict";cc._RF.push(t,"1216262TqFKgpl95ndvMrre","BgmAudio");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.BgmAudio=void 0;var s=e("../asset/AssetMgr"),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),Object.defineProperty(t.prototype,"vol",{get:function(){return cc.audioEngine.getMusicVolume()},set:function(e){cc.audioEngine.setMusicVolume(e.limit(0,1))},enumerable:!1,configurable:!0}),t.prototype.onDestroy=function(){},t.prototype.play=function(e){return i(this,void 0,Promise,function(){var t,n;return c(this,function(r){switch(r.label){case 0:return e instanceof cc.AudioClip?(n=e,[3,3]):[3,1];case 1:return[4,s.AssetMgr.inst().loadAsset(e,cc.AudioClip,!0)];case 2:n=r.sent(),r.label=3;case 3:return t=n,cc.audioEngine.playMusic(t,!0),[2]}})})},t.prototype.stop=function(){cc.audioEngine.stopMusic()},t.prototype.pause=function(){cc.audioEngine.pauseMusic()},t.prototype.resume=function(){cc.audioEngine.resumeMusic()},t}(e("../util/Singleton").Singleton);n.BgmAudio=u,cc._RF.pop()},{"../asset/AssetMgr":"AssetMgr","../util/Singleton":"Singleton"}],CanvasAdapt:[function(e,t,n){"use strict";cc._RF.push(t,"cb5d3whOKVI7ZZ/1cfcoY08","CanvasAdapt");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.CanvasAdapt=void 0;var c=e("../../../cfg/EventCfg"),s=e("../../event/EventMgr"),u=cc._decorator,a=u.ccclass,l=(u.property,u.menu),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onLoad=function(){var e=cc.Canvas.instance;e.fitWidth=!0,e.fitHeight=!0,cc.view.setResizeCallback(function(){return s.EventMgr.inst().emit(c.EventSrc.Resize)})},i([a,l("adapt/canvas")],t)}(cc.Component);n.CanvasAdapt=p,cc._RF.pop()},{"../../../cfg/EventCfg":"EventCfg","../../event/EventMgr":"EventMgr"}],CmptPool:[function(e,t,n){"use strict";cc._RF.push(t,"bd63c7goOpK2ryyK/xLudPO","CmptPool");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.CmptPool=void 0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.fetch=function(t){var n=e.prototype.fetch.call(this,t),r=null==n?void 0:n.getComponent(t);return r&&r.reuse&&r.reuse(),n},t.prototype.recycle=function(t,n){var r=n.getComponent(t);return r&&r.unuse&&r.unuse(),e.prototype.recycle.call(this,t,n)},t}(e("./ObjPool").ObjPool);n.CmptPool=i,cc._RF.pop()},{"./ObjPool":"ObjPool"}],ComboWork:[function(e,t,n){"use strict";cc._RF.push(t,"804bateyO1LrqFXpPr5R+zd","ComboWork");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ComboWork=void 0;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){var t,n,r;return c(this,function(){for(t=e.changes.length,n=0;n<t;n++)if(r=e.changes[n],e.model.isCrush(r))return cc.log("\u9023\u9396",r),e.finished=!1,e.load[e.load.length-1].slack=50,[2,!0];return e.finished=!0,[2,!0]})})},t}(e("../../../comm/util/WorkChain").WorkChain);n.ComboWork=s,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain"}],CrushWork:[function(e,t,n){"use strict";cc._RF.push(t,"fc94ea0dElKkb9rIcuObbWJ","CrushWork");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.CrushWork=void 0;var s=e("../../../define/GridDefine"),u=e("../../../define/TileDefine"),a=e("../../act/TileCrush"),l=e("../../act/TileTrans"),p=e("../../mvc/GridCmd"),f=e("../../../comm/util/WorkChain"),h=function(e){function t(){var t=e.call(this)||this;return t._process=null,t._process=new y,t._process.push(new d),t._process.push(new _),t._process.push(new m),t._process.push(new v),t}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){var t;return c(this,function(n){switch(n.label){case 0:return t=new p.GridCmd,e.atkers=[],[4,this._process.execute(e)];case 1:return n.sent(),s.FOR_COL_ROW(function(n){var r=e.model.getTile(n);r&&(r.trans!=u.TileType.None&&(t.add(r,new l.TileTrans(r.trans)),r.type=r.trans,r.trans=u.TileType.None,r.crushed=!1,e.atkers.push(r)),r.crushed&&(t.add(r,new a.TileCrush),e.model.setTile(n,null),e.atkers.push(r)))}),e.load.push(t),e.changes=[],[2,!0]}})})},t}(f.WorkChain);n.CrushWork=h;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){return c(this,function(){return e.changes.forEach(function(t){var n=e.model.getCrushesV(t),r=n.length;if(r>=3){var o=[],i=u.TileType.None;n.forEach(function(t,n){var c=e.model.getTile(t);0==n?r>=5?c.trans=u.TileType.Cyclone:r>=4?c.trans=u.TileType.Cross:c.crushed=!0:c.crushed=!0,o.push(c.id),i=c.type}),r>=4&&cc.log("\u8b8a\u5316V",o[0],n[0]),cc.log("\u6d88\u9664V",i,o,n)}}),[2,!0]})})},t}(f.WorkChain),y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){return c(this,function(){return e.changes.forEach(function(t){var n=e.model.getCrushesH(t),r=n.length;if(r>=3){var o=[],i=u.TileType.None;n.forEach(function(t,n){var c=e.model.getTile(t);0==n?r>=5?c.trans=u.TileType.Cyclone:r>=4?c.trans=u.TileType.Cross:c.crushed=!0:c.crushed=!0,o.push(c.id),i=c.type}),r>=4&&cc.log("\u8b8a\u5316H",o[0],n[0]),cc.log("\u6d88\u9664H",i,o,n)}}),[2,!0]})})},t}(f.WorkChain),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){return c(this,function(){return e.changes.forEach(function(t){var n=e.model.getCrushesO(t);if(n.length>=4){var r=[],o=u.TileType.None;n.forEach(function(t,n){var i=e.model.getTile(t);0==n?i.trans=u.TileType.Thunder:i.crushed=!0,r.push(i.id),o=i.type}),cc.log("\u8b8a\u5316O",r[0],n[0]),cc.log("\u6d88\u9664O",o,r,n)}}),[2,!0]})})},t}(f.WorkChain),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){return c(this,function(){return e.changes.forEach(function(t){var n=e.model.getCrushesT(t);if(n.length>=5){var r=[],o=u.TileType.None;n.forEach(function(t,n){var i=e.model.getTile(t);0==n?i.trans=u.TileType.Cyclone:i.crushed=!0,r.push(i.id),o=i.type}),cc.log("\u8b8a\u5316T",r[0],n[0]),cc.log("\u6d88\u9664T",o,r,n)}}),[2,!0]})})},t}(f.WorkChain),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){return c(this,function(){return e.changes.forEach(function(t){var n=e.model.getCrushesL(t);if(n.length>=5){var r=[];n.forEach(function(t,n){var o=e.model.getTile(t);0==n?o.trans=u.TileType.Cyclone:o.crushed=!0,r.push(o.id)}),cc.log("\u8b8a\u5316L",r[0],n[0]),cc.log("\u6d88\u9664L",r,n)}}),[2,!0]})})},t}(f.WorkChain);cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/GridDefine":"GridDefine","../../../define/TileDefine":"TileDefine","../../act/TileCrush":"TileCrush","../../act/TileTrans":"TileTrans","../../mvc/GridCmd":"GridCmd"}],DataDriven:[function(e,t,n){"use strict";cc._RF.push(t,"790e0gEIT1L3IzBCAIw1eXx","DataDriven");var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.DataDriven=void 0;var o=function(){function e(e,t){this.value=null,this._events=[],this._skip=null,this.value=e,this._skip=t}return e.prototype.emit=function(e,t){var n;(null==this._skip||this._skip(e,t))&&(null===(n=this._events)||void 0===n||n.forEach(function(n){return n(e,t)}))},e.prototype.clear=function(){this._events=[]},e.prototype.on=function(e){this._events.push(e)},e.prototype.off=function(e){var t=this._events.findIndex(function(t){return t==e});-1!=t&&this._events.splice(t,1)},r([function(e,t){delete e[t];var n="_"+t;Object.defineProperty(e,n,{writable:!0,enumerable:!0,configurable:!0}),Object.defineProperty(e,t,{get:function(){return this[n]},set:function(e){this[n]=e;var t=this.emit;t&&t.call(this,e,this[n])},enumerable:!0,configurable:!0})}],e.prototype,"value",void 0),e}();n.DataDriven=o,cc._RF.pop()},{}],DebugPnl:[function(e,t,n){"use strict";cc._RF.push(t,"40308wxg7BAT6wqHx20lUhr","DebugPnl");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.DebugPnl=void 0;var c=e("../cfg/EventCfg"),s=e("../comm/event/EventMgr"),u=e("../define/GameDefine"),a=cc._decorator,l=a.ccclass,p=a.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.edit1=null,t.edit2=null,t.edit3=null,t}return o(t,e),t.prototype.onBtn1Click=function(){var e=Number(this.edit1.string),t=Number(this.edit2.string),n=Number(this.edit3.string);s.EventMgr.inst().emit(c.EventSrc.DebugType,{x:e,y:t},n)},t.prototype.onBtn2Click=function(){s.EventMgr.inst().emit(c.EventSrc.Charge,u.MAX_ENERGY)},t.prototype.onBtn3Click=function(){s.EventMgr.inst().emit(c.EventSrc.DebugCd)},t.prototype.onBtn4Click=function(){s.EventMgr.inst().emit(c.EventSrc.DebugWin)},i([p(cc.EditBox)],t.prototype,"edit1",void 0),i([p(cc.EditBox)],t.prototype,"edit2",void 0),i([p(cc.EditBox)],t.prototype,"edit3",void 0),i([l],t)}(cc.Component);n.DebugPnl=f,cc._RF.pop()},{"../cfg/EventCfg":"EventCfg","../comm/event/EventMgr":"EventMgr","../define/GameDefine":"GameDefine"}],DebugTool:[function(e,t,n){"use strict";cc._RF.push(t,"6d926O2PtVHNqZ+BLqFLm+J","DebugTool");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.DebugTool=void 0;var c=e("../define/GameDefine"),s=cc._decorator,u=s.ccclass,a=s.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pnl=null,t.ver=null,t}return o(t,e),t.prototype.onLoad=function(){this.node.active=!1,this.pnl.active=!1,this.ver.string=c.VER},t.prototype.onClick=function(){this.pnl.active=!this.pnl.active},i([a(cc.Node)],t.prototype,"pnl",void 0),i([a(cc.Label)],t.prototype,"ver",void 0),i([u],t)}(cc.Component);n.DebugTool=l,cc._RF.pop()},{"../define/GameDefine":"GameDefine"}],DesktopAdapt:[function(e,t,n){"use strict";cc._RF.push(t,"9141fEPpWlB9oUAF5oD4qNc","DesktopAdapt");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.DesktopAdapt=void 0;var c=e("../../../cfg/EventCfg"),s=e("../../event/EventDecor"),u=cc._decorator,a=u.ccclass,l=(u.property,u.menu),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onLoad=function(){this.adjust()},t.prototype.adjust=function(){var e=this.node.width,t=this.node.height,n=cc.view.getCanvasSize(),r=Math.min(n.width/e,n.height/t),o=e*r,i=t*r;this.node.scale=Math.max(n.width/o,n.height/i)},i([s.onEvent(c.EventSrc.Resize)],t.prototype,"adjust",null),i([a,l("adapt/desktop"),s.onEnable()],t)}(cc.Component);n.DesktopAdapt=p,cc._RF.pop()},{"../../../cfg/EventCfg":"EventCfg","../../event/EventDecor":"EventDecor"}],DropWork:[function(e,t,n){"use strict";cc._RF.push(t,"5f5b8WOGHhLNo9l/iQYmeaf","DropWork");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.DropWork=void 0;var s=e("../../../define/GridDefine"),u=e("../../act/TileFall"),a=e("../../act/TileWait"),l=e("../../mvc/GridCmd"),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e,t){return i(this,void 0,Promise,function(){var n;return c(this,function(){return n=new l.GridCmd,s.FOR_ROW_COL(function(r){if(!(t&&t!=r.x||e.model.getTile(r)))for(var o=r.y;o<s.GRID_ROW;o++){var i={x:r.x,y:o},c=e.model.getTile(i);if(c){if(c.hold)return;return cc.log("\u6389\u843d",c.id,c.type,r),e.model.setTile(r,c),e.model.setTile(i,null),n.add(c,new a.TileWait(.1)),n.add(c,new u.TileFall(r)),e.changes.push(r),void e.load.push(n)}}}),[2,!0]})})},t}(e("../../../comm/util/WorkChain").WorkChain);n.DropWork=p,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/GridDefine":"GridDefine","../../act/TileFall":"TileFall","../../act/TileWait":"TileWait","../../mvc/GridCmd":"GridCmd"}],DutyUI:[function(e,t,n){"use strict";cc._RF.push(t,"7aca0ad475BoqBtarqK8/rx","DutyUI");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.DutyUI=void 0;var u=e("./UIBase"),a=cc._decorator,l=a.ccclass,p=a.property,f=a.menu,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.prefab=null,t._duty=null,t.parent=null,t}return o(t,e),t.prototype.call=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return c(this,void 0,Promise,function(){var n,r;return s(this,function(){return null==this._duty&&((n=cc.instantiate(this.prefab)).parent=null!==(e=this.parent)&&void 0!==e?e:this.node,this._duty=n.getComponent(u.UIBase)),[2,(r=this._duty).show.apply(r,t)]})})},t.prototype.show=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return c(this,void 0,Promise,function(){var t;return s(this,function(n){switch(n.label){case 0:return[4,this._duty];case 1:return n.sent()?(t=this._duty).show.apply(t,e):this.call.apply(this,e),[2]}})})},t.prototype.hide=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return c(this,void 0,Promise,function(){var t;return s(this,function(n){switch(n.label){case 0:return[4,this._duty];case 1:return n.sent()&&(t=this._duty).hide.apply(t,e),[2]}})})},i([p(cc.Prefab)],t.prototype,"prefab",void 0),i([p(cc.Node)],t.prototype,"parent",void 0),i([l,f("ui/duty")],t)}(u.UIBase);n.DutyUI=h,cc._RF.pop()},{"./UIBase":"UIBase"}],EnemyAtk:[function(e,t,n){"use strict";cc._RF.push(t,"adf0a2MXydHjanbkZkB8YBP","EnemyAtk");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.EnemyAtk=void 0;var s=e("../../../comm/util/WorkChain"),u=e("../../../define/GridDefine"),a=e("../../../define/TileDefine"),l=e("../../act/TileAtk"),p=e("../../act/TileDie"),f=e("../../act/TileHit"),h=e("../../mvc/GridCmd"),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._param=null,t._cmd=null,t}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){var t=this;return c(this,function(){return this._param=e,this._cmd=new h.GridCmd,this._cmd.mask=!0,e.enemyAtks.forEach(function(n){var r=e.model.getTileById(n);t._cmd.add(r,new l.TileAtk)}),this._cmd.pass(.8),e.enemyAtks.forEach(function(n){var r=e.model.getTileById(n);Object.values(u.FOUR_DIR).forEach(function(e){return t.attack(r,e)})}),this._cmd.deed.size>0&&e.load.push(this._cmd),[2,!0]})})},t.prototype.attack=function(e,t){var n=e.pos.x+t.x,r=e.pos.y+t.y,o=this._param.model.getTile({x:n,y:r});if(o&&o.group==a.TileGroup.Player){var i=e.atk-o.def;i=i.limit(1,e.atk),o.decHp(i),this._cmd.add(o,new f.TileHit(i)),cc.log(e.id+"\u666e\u653b"+o.id+", \u50b7\u5bb3"+i+", \u5269\u8840"+o.currHp,e.pos,e.type,o.pos,o.type),this.dead(o)}},t.prototype.dead=function(e){e.currHp<=0&&(this._cmd.add(e,new p.TileDie),this._param.model.setTile(e.pos,null),cc.log(e.id+"\u6b7b\u4ea1",e.pos))},t}(s.WorkChain);n.EnemyAtk=d,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/GridDefine":"GridDefine","../../../define/TileDefine":"TileDefine","../../act/TileAtk":"TileAtk","../../act/TileDie":"TileDie","../../act/TileHit":"TileHit","../../mvc/GridCmd":"GridCmd"}],EnemyPort:[function(e,t,n){"use strict";cc._RF.push(t,"245a2pek5xIcrykOKM+KgBC","EnemyPort");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.EnemyPort=void 0;var s=e("../../../comm/util/WorkChain"),u=e("../../../define/TileDefine"),a=e("../battle/EnemyAtk"),l=e("../battle/EnemyWalk"),p=e("./NormPort"),f=function(e){function t(){var t=e.call(this)||this;return t._process=null,t._process=new l.EnemyWalk,t._process.push(new a.EnemyAtk),t._process.push(new p.NormPort),t}return o(t,e),t.prototype.clear=function(e){e.changes=[],e.finished=!1,e.atkers=[]},t.prototype.business=function(e){return i(this,void 0,Promise,function(){var t;return c(this,function(n){switch(n.label){case 0:return this.clear(e),e.model.enemies.forEach(function(t){t&&t.group==u.TileGroup.Enemy&&t.cd<=0&&e.atkers.push(t)}),e.atkers.length>0?(t=Array.from(e.atkers),[4,this._process.execute(e,!0)]):[3,2];case 1:n.sent(),t.forEach(function(e){e&&(e.cooldown(),cc.log("\u51b7\u537b",e.id,e.cd))}),n.label=2;case 2:return[2,!0]}})})},t}(s.WorkChain);n.EnemyPort=f,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/TileDefine":"TileDefine","../battle/EnemyAtk":"EnemyAtk","../battle/EnemyWalk":"EnemyWalk","./NormPort":"NormPort"}],EnemyWalk:[function(e,t,n){"use strict";cc._RF.push(t,"18b3ahGlblGh5Evcwr6LMVf","EnemyWalk");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.EnemyWalk=void 0;var s=e("../../../comm/util/WorkChain"),u=e("../../../define/GridDefine"),a=e("../../../define/TileDefine"),l=e("../../act/TileCd"),p=e("../../act/TileSwap"),f=e("../../mvc/GridCmd"),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._param=null,t._cmd=null,t._last=null,t}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){var t=this;return c(this,function(){return this._param=e,e.enemyAtks=[],e.changes=[],this._cmd=new f.GridCmd,Array.from(e.model.enemies).filter(function(e){return e.cd<=0}).forEach(function(n){return t.walk(e.model.getTileById(n.id))},this),this._cmd.deed.size>0&&(this._param.load.push(this._cmd),this._cmd.mask=!0),[2,!0]})})},t.prototype.walk=function(e){this._last=e.pos;for(var t=0;t<e.dex&&!this.contacted(e.pos,e);t++)this.step(e);this._cmd.add(e,new l.TileCd),this._param.skip.push(e.id)},t.prototype.contacted=function(e,t){for(var n=Object.values(u.FOUR_DIR),r=n.length,o=0;o<r;o++){var i={x:e.x+n[o].x,y:e.y+n[o].y},c=this._param.model.getTile(i);if(c&&c.group==a.TileGroup.Player)return this._param.atkers.push(t),this._param.enemyAtks.push(t.id),!0}return!1},t.prototype.cost=function(e,t){var n=this._param.model.getTile(e);return n&&n.group==a.TileGroup.Norm&&n.id>=0?Math.abs(t.x-e.x)+Math.abs(t.y-e.y):Number.MAX_SAFE_INTEGER},t.prototype.step=function(e){for(var t=Object.values(u.FOUR_DIR),n=t.length,r=e.pos,o=Number.MAX_SAFE_INTEGER,i=0;i<n;i++){var c={x:e.pos.x+t[i].x,y:e.pos.y+t[i].y};if(!this._last||!u.SAME_POS(this._last,c)){var s=this.cost(c,this._param.model.player.pos);o>s&&(o=s,r=c)}}0==u.SAME_POS(e.pos,r)&&(this._param.changes.push(e.pos),this._param.changes.push(r),this._last=e.pos,this.swap(e.pos,r))},t.prototype.swap=function(e,t){var n=this._param.model.getTile(e),r=this._param.model.getTile(t);cc.log("\u884c\u8d70",n.id,e,t),this._cmd.add(n,new p.TileSwap(t)),this._cmd.add(r,new p.TileSwap(e)),this._param.model.setTile(e,r),this._param.model.setTile(t,n)},t}(s.WorkChain);n.EnemyWalk=h,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/GridDefine":"GridDefine","../../../define/TileDefine":"TileDefine","../../act/TileCd":"TileCd","../../act/TileSwap":"TileSwap","../../mvc/GridCmd":"GridCmd"}],EventCfg:[function(e,t,n){"use strict";cc._RF.push(t,"ce7f10yKOJGHbNbTO9/8szi","EventCfg"),Object.defineProperty(n,"__esModule",{value:!0}),n.EventSrc=void 0,function(e){e[e.Resize=0]="Resize",e[e.Focus=1]="Focus",e[e.Blur=2]="Blur",e[e.Scale=3]="Scale",e[e.DebugType=4]="DebugType",e[e.DebugCd=5]="DebugCd",e[e.DebugWin=6]="DebugWin",e[e.Fight=7]="Fight",e[e.Charge=8]="Charge",e[e.Ultimate=9]="Ultimate",e[e.Crushed=10]="Crushed",e[e.Lose=11]="Lose",e[e.Playing=12]="Playing"}(n.EventSrc||(n.EventSrc={})),cc._RF.pop()},{}],EventDecor:[function(e,t,n){"use strict";cc._RF.push(t,"bfa7dJbbTROeqnRcFz816Ns","EventDecor"),Object.defineProperty(n,"__esModule",{value:!0}),n.onEvent=n.onEnable=n.onLoad=void 0;var r=e("./EventMgr");function o(e,t,n){var o=e.prototype[t];e.prototype[t]=function(){r.EventMgr.register(this),o&&o.call(this)};var i=e.prototype[n];e.prototype[n]=function(){r.EventMgr.unregister(this),i&&i.call(this)}}n.onLoad=function(){return function(e){o(e,"onLoad","onDestroy")}},n.onEnable=function(){return function(e){o(e,"onEnable","onDisable")}},n.onEvent=function(e,t){return void 0===t&&(t=!1),function(n,o){var i=r.EventMgr.container.get(n.constructor);null==i&&(i=[],r.EventMgr.container.set(n.constructor,i)),i.push({key:e,func:o,once:t})}},cc._RF.pop()},{"./EventMgr":"EventMgr"}],EventMgr:[function(e,t,n){"use strict";cc._RF.push(t,"23910doGkZP15FshwfnmI0H","EventMgr");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.EventMgr=void 0;var s=function(e){function t(){var n=e.call(this)||this;return n._events=new Map,t._on=n.on.bind(n),t._off=function(e){n._events.forEach(function(t,r){t.get(e).length=0,t.delete(e),t.size<=0&&n._events.delete(r)})},n}return o(t,e),t.register=function(e){var t=this;this.container.get(e.constructor).forEach(function(n){t._on(e,n.key,e[n.func],n.once)},this)},t.unregister=function(e){this._off(e)},t.prototype.onDestroy=function(){t._on=null,t._off=null,this._events.forEach(function(e){e.forEach(function(){return[]}),e.clear()}),this._events.clear(),t.container.forEach(function(){return[]}),t.container.clear()},t.prototype.on=function(e,t,n,r){void 0===r&&(r=!1);var o=this._events.get(t),i=[];o?null==(i=o.get(e))&&(i=[],o.set(e,i)):((o=new Map).set(e,i),this._events.set(t,o)),i.push({event:n,once:r})},t.prototype.once=function(e,t,n){this.on(e,t,n,!0)},t.prototype.off=function(e,t,n){var r,o=this._events.get(t),i=o.get(e),c=null!==(r=null==i?void 0:i.findIndex(function(e){return e.event==n}))&&void 0!==r?r:-1;-1!=c&&i.splice(c,1),i&&i.length<=0&&(o.delete(e),o.size<=0&&this._events.delete(t))},t.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.listeners(e).forEach(function(e){return e.event.apply(e.target,t)})},t.prototype.emitAsync=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return i(this,void 0,Promise,function(){var n;return c(this,function(r){switch(r.label){case 0:return n=[],this.listeners(e).forEach(function(e){return n.push(e.target,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.listeners=function(e){var t=this,n=this._events.get(e);if(null==n)return[];var r=[],o=[];return n.forEach(function(e,t){e.forEach(function(e){var n={target:t,event:e.event};r.push(Object.assign({},n)),e.once&&o.push(Object.assign({},n))})}),o.forEach(function(n){return t.off(n.target,e,n.event)},this),r},t.container=new Map,t._on=null,t._off=null,t}(e("../util/Singleton").Singleton);n.EventMgr=s,s.inst(),cc._RF.pop()},{"../util/Singleton":"Singleton"}],FirstCheck:[function(e,t,n){"use strict";cc._RF.push(t,"bd187/EeflPcIdyj7iSHMBU","FirstCheck");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.FirstCheck=void 0;var s=e("../../../comm/util/WorkChain"),u=e("../../act/TileSelect"),a=e("../../mvc/GridCmd"),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){return c(this,function(){return e.from?[2,!0]:(cc.log("\u521d\u9078",e.to.tile.id),e.load.push((new a.GridCmd).add(e.to.tile,new u.TileSelect(!0))),e.from=e.to,e.to=null,[2,!1])})})},t}(s.WorkChain);n.FirstCheck=l,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../act/TileSelect":"TileSelect","../../mvc/GridCmd":"GridCmd"}],GameDefine:[function(e,t,n){"use strict";cc._RF.push(t,"51a5025505L4KmYV/KkIB/b","GameDefine"),Object.defineProperty(n,"__esModule",{value:!0}),n.ULT_DAMAGE=n.MAX_ENERGY=n.ROLE_TABLE=n.MAX_STAGE=n.START_STAGE=n.STAGE_RULE=n.PLAYER_START=n.VER=void 0,n.VER="2.2.5",n.PLAYER_START={x:3,y:7},n.STAGE_RULE={0:{block:{min:2,max:5},enemy:{min:3,max:5,types:[400,401,402],weights:[6,4,2]},pass:{400:10,401:4,402:3}},1:{block:{min:0,max:0},enemy:{min:3,max:21,types:[400,401,402],weights:[120,0,0]},pass:{400:5,401:0,402:0}},2:{block:{min:0,max:0},enemy:{min:3,max:21,types:[400,401,402],weights:[0,120,0]},pass:{400:0,401:5,402:0}},3:{block:{min:2,max:3},enemy:{min:3,max:21,types:[400,401,402],weights:[80,40,0]},pass:{400:5,401:3,402:0}},4:{block:{min:2,max:3},enemy:{min:3,max:21,types:[400,401,402],weights:[90,0,30]},pass:{400:5,401:0,402:3}},5:{block:{min:3,max:5},enemy:{min:3,max:21,types:[400,401,402],weights:[60,40,20]},pass:{400:5,401:0,402:5}},6:{block:{min:3,max:5},enemy:{min:3,max:21,types:[400,401,402],weights:[0,80,40]},pass:{400:5,401:5,402:4}},7:{block:{min:6,max:8},enemy:{min:3,max:21,types:[400,401,402],weights:[60,0,60]},pass:{400:5,401:5,402:8}},8:{block:{min:6,max:8},enemy:{min:3,max:21,types:[400,401,402],weights:[60,40,20]},pass:{400:7,401:5,402:10}},9:{block:{min:6,max:8},enemy:{min:3,max:21,types:[400,401,402],weights:[60,40,20]},pass:{400:10,401:7,402:12}},10:{block:{min:6,max:8},enemy:{min:3,max:21,types:[400,401,402],weights:[60,40,20]},pass:{400:13,401:7,402:12}},11:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[60,40,20]},pass:{400:15,401:9,402:14}},12:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[60,40,20]},pass:{400:17,401:9,402:14}},13:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[60,40,20]},pass:{400:19,401:11,402:16}},14:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[65,45,25]},pass:{400:20,401:13,402:18}},15:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[70,50,30]},pass:{400:20,401:15,402:20}},16:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[75,55,35]},pass:{400:20,401:15,402:20}},17:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[80,60,40]},pass:{400:20,401:15,402:20}},18:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[85,65,45]},pass:{400:220,401:15,402:20}},19:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[90,70,50]},pass:{400:20,401:15,402:20}},20:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[95,75,55]},pass:{400:20,401:15,402:20}},21:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},22:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},23:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},24:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},25:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},26:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},27:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},28:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},29:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},30:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},31:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},32:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},33:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},34:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},35:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},36:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},37:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},38:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},39:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},40:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},41:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},42:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},43:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},44:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},45:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},46:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},47:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},48:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},49:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}},50:{block:{min:7,max:10},enemy:{min:3,max:21,types:[400,401,402],weights:[100,80,60]},pass:{400:20,401:15,402:20}}},n.START_STAGE=1,n.MAX_STAGE=Object.keys(n.STAGE_RULE).length-1,n.ROLE_TABLE={0:{hp:1,atk:30,def:0,energy:1},1:{hp:1,atk:30,def:0,energy:1},2:{hp:1,atk:30,def:0,energy:1},3:{hp:1,atk:30,def:0,energy:1},100:{hp:1},101:{hp:2},200:{atk:100},300:{atk:55},301:{atk:55},302:{atk:55},400:{hp:100,atk:10,def:5,cd:2,dex:2,energy:10},401:{hp:90,atk:5,def:0,cd:2,dex:3,energy:10},402:{hp:120,atk:30,def:25,cd:3,dex:1,energy:10},500:{hp:300,atk:1,def:0,cd:1},999:{hp:0,atk:0,def:0,cd:0,dex:0}},n.MAX_ENERGY=200,n.ULT_DAMAGE=50,cc._RF.pop()},{}],GameMgr:[function(e,t,n){"use strict";cc._RF.push(t,"0562cid6/tHHYag995KuafP","GameMgr");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.GameMgr=void 0;var c=e("../cfg/AudioCfg"),s=e("../comm/asset/AssetMgr"),u=e("../comm/audio/BgmAudio"),a=e("../comm/audio/SfxAudio"),l=e("../comm/event/EventMgr"),p=e("../comm/pool/CmptPool"),f=cc._decorator,h=f.ccclass,d=(f.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onLoad=function(){cc.game.setFrameRate(60),cc.debug.setDisplayStats(!0),cc.dynamicAtlasManager.enabled=!0;var e=cc.director.getCollisionManager();e.enabled=!0,e.enabledDebugDraw=!1},t.prototype.onDestroy=function(){a.SfxAudio.destroy(),u.BgmAudio.destroy(),l.EventMgr.destroy(),p.CmptPool.destroy(),s.AssetMgr.destroy()},t.prototype.start=function(){s.AssetMgr.inst().loadAsset(c.AudioSrc.LoopBgm,cc.AudioClip,!0).then(function(e){u.BgmAudio.inst().play(e)})},i([h],t)}(cc.Component));n.GameMgr=d,cc._RF.pop()},{"../cfg/AudioCfg":"AudioCfg","../comm/asset/AssetMgr":"AssetMgr","../comm/audio/BgmAudio":"BgmAudio","../comm/audio/SfxAudio":"SfxAudio","../comm/event/EventMgr":"EventMgr","../comm/pool/CmptPool":"CmptPool"}],GridCmd:[function(e,t,n){"use strict";cc._RF.push(t,"4ffe2KtsGhAi6l+Mn5Muwn+","GridCmd"),Object.defineProperty(n,"__esModule",{value:!0}),n.GridCmd=n.TileCmd=n.TilePlay=void 0;var r=e("./model/TileModel");n.TilePlay=function(){this.start=0};var o=function(){function e(e){this.base=new r.TileModel(-1),this.seq=[],Object.assign(this.base,e)}return e.prototype.clear=function(){this.seq.forEach(function(){return null}),this.seq=[],this.base=null},e.prototype.add=function(e){this.seq.push(e)},e}();n.TileCmd=o;var i=function(){function e(){this.deed=new Map,this._timeline=0,this.slack=0,this.mask=!1}return e.prototype.clear=function(){this.deed.forEach(function(e){e.clear(),e=null}),this.deed.clear()},e.prototype.add=function(e,t){var n,r=e.id,i=null!==(n=this.deed.get(r))&&void 0!==n?n:new o(e);return this.deed.set(r,i),t.start=this._timeline,i.add(t),this},e.prototype.pass=function(e){this._timeline+=e},e}();n.GridCmd=i,cc._RF.pop()},{"./model/TileModel":"TileModel"}],GridCtrlBase:[function(e,t,n){"use strict";cc._RF.push(t,"62c2a9zBexMcZhJw3qLm4Q3","GridCtrlBase");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.GridCtrlBase=void 0;var c=e("../../../define/GridDefine"),s=e("../../../define/TileDefine"),u=e("../../select/SelectHandler"),a=e("../model/GridModel"),l=e("../view/GridView"),p=cc._decorator,f=p.ccclass,h=p.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._model=null,t._view=null,t.window=null,t}return o(t,e),t.prototype.onLoad=function(){this.window&&(this.window.width=c.GRID_W,this.window.height=c.GRID_H)},t.prototype.onEnable=function(){this._model=new a.GridModel,this._view=this.getComponentInChildren(l.GridView)},t.prototype.start=function(){var e=this._view.node;e.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),e.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this)},t.prototype.onDestroy=function(){u.SelectHandler.destroy(),this._model.clear(),this._model=null},t.prototype.onTouchStart=function(e){this.select(this.convertPos(e))},t.prototype.onTouchMove=function(e){var t=u.SelectHandler.inst().selected,n=this.convertPos(e);t&&0==c.SAME_POS(t,n)&&this.select(this.convertPos(e))},t.prototype.convertPos=function(e){var t=this._view.node.convertToNodeSpaceAR(e.getLocation());return{x:Math.floor(t.x/s.TILE_W),y:Math.floor(t.y/s.TILE_H)}},i([h(cc.Node)],t.prototype,"window",void 0),i([f],t)}(cc.Component);n.GridCtrlBase=d,cc._RF.pop()},{"../../../define/GridDefine":"GridDefine","../../../define/TileDefine":"TileDefine","../../select/SelectHandler":"SelectHandler","../model/GridModel":"GridModel","../view/GridView":"GridView"}],GridCtrl:[function(e,t,n){"use strict";cc._RF.push(t,"7a413+ZZVZJIZHsVSkqljbp","GridCtrl");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.GridCtrl=void 0;var u=e("../../../define/GameDefine"),a=e("../../../define/GridDefine"),l=e("../../../define/TileDefine"),p=e("../../act/TileSpawn"),f=e("./StageCtrl"),h=e("../GridCmd"),d=e("../view/GridView"),y=e("../../../comm/util/RandUtil"),_=e("../model/GridModel"),m=e("./GridCtrlBase"),v=e("../../select/SelectHandler"),b=e("../../../comm/event/EventDecor"),g=e("../../../cfg/EventCfg"),w=e("../../act/TileTrans"),T=e("../../../comm/event/EventMgr"),x=cc._decorator,O=x.ccclass,k=(x.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._model=null,t._playing=!1,t}var n;return o(t,e),n=t,Object.defineProperty(t,"inst",{get:function(){return this._inst},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){e.prototype.onLoad.call(this),n._inst=this},t.prototype.onEnable=function(){this._model=new _.GridModel,this._view=this.getComponentInChildren(d.GridView)},t.prototype.play=function(e){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return[4,this._view.accept(e)];case 1:return t.sent()&&this._model.print(),[2]}})})},t.prototype.fight=function(){return c(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return this.genNorm(),this.genPlayer(),this.genBlocks(),this.genEnemies(),[4,this.expose()];case 1:return e.sent(),[2]}})})},t.prototype.genNorm=function(){var e=l.NORM_TILE.min,t=l.NORM_TILE.max,n=this;a.FOR_COL_ROW(function(r){var o=n._model.getTile(r);o.type=n._model.getRandNorm();for(var i=e;i<t;i++){if(!n._model.isCrush(r))return;var c=o.type;o.type=++c>=t?e:c}cc.warn("\u91cd\u8907",o.id,r)})},t.prototype.genPlayer=function(){this._model.getTile(u.PLAYER_START).type=l.TileType.Hero},t.prototype.genBlocks=function(){var e=f.StageCtrl.inst.data.block,t=y.RandUtil.randInt(e.max+1,e.min),n=0;do{var r=this._model.getTile(this.randPos());r.group==l.TileGroup.Norm&&(r.type=y.RandUtil.randTypes([l.TileType.Stone,l.TileType.Rock]),n++)}while(n<t)},t.prototype.genEnemies=function(){var e=f.StageCtrl.inst.data.enemy,t=e.min,n=0;do{var r=this._model.getTile(this.randPos());if(r.group==l.TileGroup.Norm){var o=y.RandUtil.randWeights(e.weights);r.type=e.types[o],n++}}while(n<t)},t.prototype.randPos=function(){return{x:y.RandUtil.randInt(a.GRID_COL),y:y.RandUtil.randInt(a.GRID_ROW)}},t.prototype.expose=function(){return c(this,void 0,Promise,function(){var e,t=this;return s(this,function(n){switch(n.label){case 0:return e=new h.GridCmd,a.FOR_COL_ROW(function(n){var r=t._model.getTile(n);e.add(r,new w.TileTrans(r.type)),e.add(r,new p.TileSpawn),e.pass(.01)}),[4,this.play(e)];case 1:return n.sent(),[2]}})})},t.prototype.select=function(e){return c(this,void 0,Promise,function(){var t;return s(this,function(n){switch(n.label){case 0:return 0==this._model.checkPos(e)||this._playing?[2]:(this._playing=!0,T.EventMgr.inst().emit(g.EventSrc.Playing,!0),[4,v.SelectHandler.inst().execute(this._model,e)]);case 1:return(t=n.sent())?[4,this.play(t)]:[3,3];case 2:n.sent(),n.label=3;case 3:return this._playing=!1,T.EventMgr.inst().emit(g.EventSrc.Playing,!1),[2]}})})},t.prototype.ultimate=function(){return c(this,void 0,Promise,function(){var e;return s(this,function(t){switch(t.label){case 0:return e=this.play,[4,v.SelectHandler.inst().executeUlt(this._model)];case 1:return[4,e.apply(this,[t.sent()])];case 2:return t.sent(),[2]}})})},t.prototype.onDebugType=function(e,t){var n=this._model.getTile(e);n&&(n.type=t,this._view.accept((new h.GridCmd).add(n,new w.TileTrans(t))),this._model.print())},t.prototype.onDebugCd=function(){this._model.player.cd=0},t._inst=null,i([b.onEvent(g.EventSrc.Ultimate)],t.prototype,"ultimate",null),i([b.onEvent(g.EventSrc.DebugType)],t.prototype,"onDebugType",null),i([b.onEvent(g.EventSrc.DebugCd)],t.prototype,"onDebugCd",null),n=i([O,b.onEnable()],t)}(m.GridCtrlBase));n.GridCtrl=k,cc._RF.pop()},{"../../../cfg/EventCfg":"EventCfg","../../../comm/event/EventDecor":"EventDecor","../../../comm/event/EventMgr":"EventMgr","../../../comm/util/RandUtil":"RandUtil","../../../define/GameDefine":"GameDefine","../../../define/GridDefine":"GridDefine","../../../define/TileDefine":"TileDefine","../../act/TileSpawn":"TileSpawn","../../act/TileTrans":"TileTrans","../../select/SelectHandler":"SelectHandler","../GridCmd":"GridCmd","../model/GridModel":"GridModel","../view/GridView":"GridView","./GridCtrlBase":"GridCtrlBase","./StageCtrl":"StageCtrl"}],GridDefine:[function(e,t,n){"use strict";cc._RF.push(t,"47bc0b7cVNAJLd4T8KqhA08","GridDefine"),Object.defineProperty(n,"__esModule",{value:!0}),n.FOR_ROW_COL=n.FOR_COL_ROW=n.FOR_ROW=n.FOR_COL=n.FOUR_DIR=n.SAME_POS=n.FALL_SPEED=n.GRID_H=n.GRID_W=n.GRID_ROW=n.GRID_COL=void 0;var r=e("./TileDefine");n.GRID_COL=7,n.GRID_ROW=9,n.GRID_W=n.GRID_COL*r.TILE_W,n.GRID_H=n.GRID_ROW*r.TILE_H,n.FALL_SPEED=.6/n.GRID_H,n.SAME_POS=function(e,t){return e.x==t.x&&e.y==t.y},n.FOUR_DIR={right:{x:1,y:0},bottom:{x:0,y:-1},left:{x:-1,y:0},top:{x:0,y:1}},n.FOR_COL=function(e){for(var t=0;t<n.GRID_COL;t++)e(t)},n.FOR_ROW=function(e){for(var t=0;t<n.GRID_ROW;t++)e(t)},n.FOR_COL_ROW=function(e){n.FOR_ROW(function(t){return n.FOR_COL(function(n){return e({x:n,y:t})})})},n.FOR_ROW_COL=function(e){n.FOR_COL(function(t){return n.FOR_ROW(function(n){return e({x:t,y:n})})})},cc._RF.pop()},{"./TileDefine":"TileDefine"}],GridDirector:[function(e,t,n){"use strict";cc._RF.push(t,"31c1d5xHCtEPbpAqJUkVZuA","GridDirector"),Object.defineProperty(n,"__esModule",{value:!0}),n.GridDirector=void 0;var r=e("../../cfg/AudioCfg"),o=e("../../comm/asset/AssetMgr"),i=e("../../comm/audio/SfxAudio"),c=e("../../define/GridDefine"),s=e("../../define/TileDefine"),u=e("./view/SfxView"),a=function(){function e(e){this._host=null,this._perform=new Map,this._tween=null,this._layer=!1,this._host=e,this._perform.set(s.TileAct.Spawn,this.spawn),this._perform.set(s.TileAct.Fall,this.fall),this._perform.set(s.TileAct.Select,this.select),this._perform.set(s.TileAct.Swap,this.swap),this._perform.set(s.TileAct.Crush,this.crush),this._perform.set(s.TileAct.Trans,this.trans),this._perform.set(s.TileAct.Wait,this.wait),this._perform.set(s.TileAct.Move,this.move),this._perform.set(s.TileAct.Slip,this.slip),this._perform.set(s.TileAct.Hit,this.hit),this._perform.set(s.TileAct.Die,this.die),this._perform.set(s.TileAct.Next,this.next),this._perform.set(s.TileAct.Skill,this.skill),this._perform.set(s.TileAct.Atk,this.atk),this._perform.set(s.TileAct.Cd,this.cooldown)}return e.prototype.execute=function(e,t,n,r){return this._tween=e,this._perform.has(t)?this._perform.get(t).call(this,n,r):0},e.prototype.spawn=function(e,t){var n=e.skip?0:.1;return n<=0?(t.node.active=!0,t.node.scale=1):(this._tween.call(function(){t.node.scale=0,t.node.active=!0}),this._tween.to(n,{scale:1})),n},e.prototype.fall=function(e,t){var n=t.node.position,r=cc.v3((e.target.x+.5)*s.TILE_W,(e.target.y+.5)*s.TILE_H,0),o=r.sub(n).mag()*c.FALL_SPEED;return this._tween.to(o,{position:r},{easing:cc.easing.quadIn}),o},e.prototype.select=function(e,t){return this._tween.call(function(){o.AssetMgr.inst().loadAsset(r.AudioSrc.Select,cc.AudioClip,!0).then(function(e){i.SfxAudio.inst().play(e)}),t.select(e.selected)}),this._tween.call(function(){return t.node.zIndex=e.selected?s.TileGroup.Max:t.group}),this._tween.to(.1,{scale:e.selected?1.3:1}),.1},e.prototype.swap=function(e,t){var n=this,r=t.group==s.TileGroup.Enemy?.6:.3,o=(e.target.x+.5)*s.TILE_W,i=(e.target.y+.5)*s.TILE_H;return this._tween.call(function(){t.node.zIndex=t.group==s.TileGroup.Norm&&n._layer?t.group:s.TileGroup.Max,t.walk()}),this._tween.to(r,{position:cc.v3(o,i,0)}),this._tween.call(function(){return t.node.zIndex=t.group==s.TileGroup.Norm?t.group:s.TileGroup.Max}),r},e.prototype.crush=function(e,t){var n=this,c=t.group==s.TileGroup.Norm?.8:.2;return this._tween.call(function(){t.crushed(),t.node.scale=1,o.AssetMgr.inst().loadAsset(r.AudioSrc.Crush,cc.AudioClip,!0).then(function(e){i.SfxAudio.inst().play(e)})}),t.group==s.TileGroup.Norm?(this._tween.delay(c),this._tween.call(function(){return t.clear()})):this._tween.to(c,{scale:0}),this._tween.call(function(){return t.die().then(function(){return n._host.recycle(t)})},this),c},e.prototype.trans=function(e,t){var n=e.skip?0:.2;return n<=0?(t.node.scale=1,t.setType(e.target)):(this._tween.call(function(){return t.node.scale=1}),this._tween.to(n,{scale:0}),this._tween.call(function(){t.node.scale=1,t.setType(e.target)})),n},e.prototype.wait=function(e){return this._tween.delay(e.time),e.time},e.prototype.move=function(e,t){var n=e.skip?0:t.group==s.TileGroup.Enemy?.8:.3,r=(e.target.x+.5)*s.TILE_W,o=(e.target.y+.5)*s.TILE_H;return n<=0?t.node.setPosition(r,o):(this._tween.call(function(){t.node.zIndex=s.TileGroup.Max,t.walk()}),this._tween.to(n,{position:cc.v3(r,o,0)},{easing:cc.easing.quadIn}),this._tween.call(function(){return t.node.zIndex=t.group})),n},e.prototype.slip=function(e,t){var n=this,r=0,o=t.node.position;return e.path.forEach(function(e){var i=cc.v3((e.x+.5)*s.TILE_W,(e.y+.5)*s.TILE_H,0),u=i.sub(o).mag()*c.FALL_SPEED;n._tween.call(function(){return t.node.zIndex=s.TileGroup.Max}),n._tween.to(u,{position:i},{easing:cc.easing.quadIn}),n._tween.call(function(){return t.node.zIndex=t.group}),o=i,r+=u}),r},e.prototype.hit=function(e,t){var n=t.group==s.TileGroup.Enemy?.8:.2,c=n/2;return this._tween.call(function(){t.node.scale=1,t.hit(),o.AssetMgr.inst().loadAsset(r.AudioSrc.Hit,cc.AudioClip,!0).then(function(e){i.SfxAudio.inst().play(e)})}),this._tween.to(c,{scale:.8}),this._tween.to(c,{scale:1}),this._tween.call(function(){return t.decHp(e.damage)}),n},e.prototype.die=function(e,t){var n=this;return this._tween.call(function(){return t.node.scale=1}),this._tween.to(.2,{scale:0}),this._tween.call(function(){return t.die().then(function(){o.AssetMgr.inst().loadAsset(r.AudioSrc.Dead,cc.AudioClip,!0).then(function(e){i.SfxAudio.inst().play(e)}),n._host.recycle(t)})},this),.2},e.prototype.next=function(e,t){var n=this;return this._tween.call(function(){return t.node.angle=0}),this._tween.to(.5,{angle:360}),this._tween.call(function(){return t.nextRound(e.dec)}),this._tween.call(function(){return n._tween=null}),.5},e.prototype.skill=function(e,t){var n=this,r=t.node.position;return this._tween.call(function(){switch(e.eff){case s.TileType.Cross:u.SfxView.inst.showCross(r);break;case s.TileType.Thunder:u.SfxView.inst.showThunder(r);break;case s.TileType.Cyclone:u.SfxView.inst.showCyclone(r)}}),this._tween.delay(.1),this._tween.call(function(){return n._host.recycle(t)},this),.1},e.prototype.atk=function(e,t){return this._tween.call(function(){t.atk().then(function(){var e=t.node.position;switch(t.type){case s.TileType.Warrior:u.SfxView.inst.showWarriorAtk(e);break;case s.TileType.Archer:u.SfxView.inst.showArcherAtk(e);break;case s.TileType.Armor:u.SfxView.inst.showArmorAtk(e)}})}),this._tween.delay(2.1),2.1},e.prototype.cooldown=function(e,t){return this._tween.call(function(){return t.doCooldown()}),0},e.prototype.setLayer=function(e){this._layer!=e&&(this._layer=e,this._host.maskActive(e),Array.from(this._host._tiles.values()).forEach(function(t){t.group==s.TileGroup.Enemy||t.group==s.TileGroup.Player?t.node.zIndex=e?s.TileGroup.Max:t.group:t.node.zIndex=t.group}))},e}();n.GridDirector=a,cc._RF.pop()},{"../../cfg/AudioCfg":"AudioCfg","../../comm/asset/AssetMgr":"AssetMgr","../../comm/audio/SfxAudio":"SfxAudio","../../define/GridDefine":"GridDefine","../../define/TileDefine":"TileDefine","./view/SfxView":"SfxView"}],GridModelBase:[function(e,t,n){"use strict";cc._RF.push(t,"c7f10tZbStIN5/QOUqWdYct","GridModelBase"),Object.defineProperty(n,"__esModule",{value:!0}),n.GridModelBase=void 0;var r=e("../../../comm/util/RandUtil"),o=e("../../../define/GridDefine"),i=e("../../../define/TileDefine"),c=e("./TileModel"),s=function(){function e(){var e=this;this.tiles=new Map,this.layout=[],o.FOR_ROW_COL(function(t){0==t.y&&(e.layout[t.x]=[]),e.setTile(t,new c.TileModel)})}return e.prototype.clear=function(){var e=this;o.FOR_COL_ROW(function(t){return e.layout[t.x][t.y]=null}),this.layout=[]},e.prototype.getRandType=function(){return r.RandUtil.randInt(i.NORM_TILE.max+1,i.NORM_TILE.min)},e.prototype.checkPos=function(e){return e&&e.x>=0&&e.x<o.GRID_COL&&e.y>=0&&e.y<o.GRID_ROW},e.prototype.getTile=function(e){return this.checkPos(e)?this.tiles.get(this.layout[e.x][e.y]):void 0},e.prototype.setTile=function(e,t){if(this.checkPos(e))if(t){t.pos=e;var n=t.id;this.tiles.set(n,t),this.layout[e.x][e.y]=n}else(t=(n=this.layout[e.x][e.y])&&this.tiles.get(n))&&t.pos.x==e.x&&t.pos.y==e.y&&(t=null,this.tiles.delete(n)),this.layout[e.x][e.y]=void 0},e.prototype.print=function(){var e=this,t="";o.FOR_COL_ROW(function(n){var r=e.getTile({x:n.x,y:o.GRID_ROW-n.y-1});t+=(r?r.toString():"xxx(xxx)")+", ",n.x==o.GRID_COL-1&&(t+="\n")}),cc.log(t)},e}();n.GridModelBase=s,cc._RF.pop()},{"../../../comm/util/RandUtil":"RandUtil","../../../define/GridDefine":"GridDefine","../../../define/TileDefine":"TileDefine","./TileModel":"TileModel"}],GridModel:[function(e,t,n){"use strict";cc._RF.push(t,"2ebfeNnlfFHEKsIJc63kHGC","GridModel");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.GridModel=void 0;var i=e("../../../comm/util/RandUtil"),c=e("../../../define/GridDefine"),s=e("../../../define/TileDefine"),u=e("../ctrl/StageCtrl"),a=e("./GridModelBase"),l=[[{x:1,y:0},{x:1,y:1},{x:0,y:1}],[{x:0,y:1},{x:-1,y:1},{x:-1,y:0}],[{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1}],[{x:1,y:0},{x:1,y:-1},{x:0,y:-1}]],p=[[{x:1,y:0},{x:-1,y:0},{x:0,y:-1},{x:0,y:-2}],[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:2,y:0}],[{x:0,y:1},{x:0,y:-1},{x:-1,y:0},{x:-2,y:0}],[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:2}]],f=[[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:0,y:2}],[{x:0,y:1},{x:0,y:2},{x:-1,y:0},{x:-2,y:0}],[{x:-1,y:0},{x:-2,y:0},{x:0,y:-1},{x:0,y:-2}],[{x:0,y:-1},{x:0,y:-2},{x:1,y:0},{x:2,y:0}]],h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),Object.defineProperty(t.prototype,"player",{get:function(){return this.getTiles(s.TileGroup.Player)[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enemies",{get:function(){return this.getTiles(s.TileGroup.Enemy)},enumerable:!1,configurable:!0}),t.prototype.getTile=function(e){if(this.checkPos(e)){var t=this.layout[e.x][e.y];return this.tiles.get(t),this.tiles.get(t)}},t.prototype.getTiles=function(e){return Array.from(this.tiles.values()).filter(function(t){return t.group==e})},t.prototype.getTileById=function(e){return this.tiles.get(e)},t.prototype.getRandType=function(){var e,t,n=null!==(t=null===(e=this.enemies)||void 0===e?void 0:e.length)&&void 0!==t?t:0,r=u.StageCtrl.inst.data.enemy;return n>=r.max?this.getRandNorm():n<=r.min?this.getRandEnemy():i.RandUtil.randRate(10)?this.getRandEnemy():this.getRandNorm()},t.prototype.getRandNorm=function(){return e.prototype.getRandType.call(this)},t.prototype.getRandEnemy=function(){var e=u.StageCtrl.inst.data.enemy,t=i.RandUtil.randWeights(e.weights);return e.types[t]},t.prototype.isCrush=function(e){return this.getCrushesH(e).length>=3||this.getCrushesV(e).length>=3||this.getCrushesO(e).length>=4||this.getCrushesT(e).length>=5||this.getCrushesL(e).length>=5},t.prototype.getCrushesH=function(e){var t=[],n=this.getTile(e)&&this.getTile(e).type;if(s.TILE_GROUP_IS(n)!=s.TileGroup.Norm)return t;for(var r=e.x-1;r>=0;r--){var o={x:r,y:e.y},i=this.getTile(o);if(!i||i.type!=n||i.trans!=s.TileType.None)break;t.push(o)}for(r=e.x+1;r<c.GRID_COL;r++){o={x:r,y:e.y};var u=this.getTile(o);if(!u||u.type!=n||u.trans!=s.TileType.None)break;t.push(o)}return t.length>=2?t.unshift(e):t=[],t},t.prototype.getCrushesV=function(e){var t=[],n=this.getTile(e)&&this.getTile(e).type;if(s.TILE_GROUP_IS(n)!=s.TileGroup.Norm)return t;for(var r=e.y-1;r>=0;r--){var o={x:e.x,y:r},i=this.getTile(o);if(!i||i.type!=n||i.trans!=s.TileType.None)break;t.push(o)}for(r=e.y+1;r<c.GRID_ROW;r++){o={x:e.x,y:r};var u=this.getTile(o);if(!u||u.type!=n||u.trans!=s.TileType.None)break;t.push(o)}return t.length>=2?t.unshift(e):t=[],t},t.prototype.getCrushesO=function(e){var t=this,n=[],r=this.getTile(e)&&this.getTile(e).type;return s.TILE_GROUP_IS(r)!=s.TileGroup.Norm?n:(l.forEach(function(o){for(var i=o.length,c=[],u=0;u<i;u++){var a={x:e.x+o[u].x,y:e.y+o[u].y},l=t.getTile(a);if(!l||l.type!=r||l.trans!=s.TileType.None)return;c.push(a)}n=n.concat(c)}),n.length>=3?n.unshift(e):n=[],n)},t.prototype.getCrushesT=function(e){var t=this,n=[],r=this.getTile(e)&&this.getTile(e).type;return s.TILE_GROUP_IS(r)!=s.TileGroup.Norm?n:(p.forEach(function(o){for(var i=o.length,c=[],u=0;u<i;u++){var a={x:e.x+o[u].x,y:e.y+o[u].y},l=t.getTile(a);if(!l||l.type!=r||l.trans!=s.TileType.None)return;c.push(l.pos)}n=n.concat(c)}),n.length>=4?n.unshift(e):n=[],n)},t.prototype.getCrushesL=function(e){var t=this,n=[],r=this.getTile(e)&&this.getTile(e).type;return s.TILE_GROUP_IS(r)!=s.TileGroup.Norm?n:(f.forEach(function(o){for(var i=o.length,c=[],u=0;u<i;u++){var a={x:e.x+o[u].x,y:e.y+o[u].y},l=t.getTile(a);if(!l||l.type!=r||l.trans!=s.TileType.None)return;c.push(a)}n=n.concat(c)}),n.length>=4?n.unshift(e):n=[],n)},t}(a.GridModelBase);n.GridModel=h,cc._RF.pop()},{"../../../comm/util/RandUtil":"RandUtil","../../../define/GridDefine":"GridDefine","../../../define/TileDefine":"TileDefine","../ctrl/StageCtrl":"StageCtrl","./GridModelBase":"GridModelBase"}],GridView:[function(e,t,n){"use strict";cc._RF.push(t,"066deMKz0dIp6QYYrLmOpAv","GridView");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.GridView=void 0;var u=e("../../../cfg/PrefabCfg"),a=e("../../../comm/asset/AssetMgr"),l=e("../../../comm/pool/CmptPool"),p=e("../../../comm/util/WaitUtil"),f=e("../../../define/GridDefine"),h=e("./TileView"),d=e("../GridDirector"),y=e("../../../define/TileDefine"),_=cc._decorator,m=_.ccclass,v=_.property,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._tiles=new Map,t._cmd=[],t._director=null,t.mask=null,t}return o(t,e),t.prototype.onLoad=function(){this.node.anchorX=0,this.node.anchorY=0,this.node.x=-f.GRID_W/2,this.node.y=-f.GRID_H/2,this.node.width=f.GRID_W,this.node.height=f.GRID_H},t.prototype.onEnable=function(){this._director=new d.GridDirector(this),this.mask.zIndex=y.TileGroup.Max-1,this.mask.active=!1},t.prototype.onDestroy=function(){this._cmd.forEach(function(e){return e.clear()}),this._cmd=[],this._tiles.clear()},t.prototype.fetch=function(){var e;return c(this,void 0,Promise,function(){var t,n,r,o;return s(this,function(i){switch(i.label){case 0:return[4,l.CmptPool.inst().fetch(h.TileView)];case 1:return null===(e=i.sent())||void 0===e?[3,2]:(n=e,[3,4]);case 2:return o=(r=cc).instantiate,[4,a.AssetMgr.inst().loadAsset(u.PrefabSrc.Tile,cc.Prefab,!0)];case 3:n=o.apply(r,[i.sent()]),i.label=4;case 4:return(t=n).setParent(this.node),t.active=!1,[2,t.getComponent(h.TileView)]}})})},t.prototype.recycle=function(e){this._tiles.delete(e.id)&&l.CmptPool.inst().recycle(h.TileView,e.node)},t.prototype.accept=function(e){return c(this,void 0,Promise,function(){var t;return s(this,function(n){switch(n.label){case 0:if(null==e||e instanceof Array&&e.length<=0)return[2,!1];this._cmd=this._cmd.concat(e),n.label=1;case 1:return t=this._cmd.shift(),[4,this.process(t)];case 2:return n.sent(),t.slack&&t.slack>0?[4,p.WaitUtil.waitMs(t.slack)]:[3,4];case 3:n.sent(),n.label=4;case 4:n.label=5;case 5:if(this._cmd.length>0)return[3,1];n.label=6;case 6:return[2,!0]}})})},t.prototype.process=function(e){return c(this,void 0,Promise,function(){var t,n,r,o,i,c,u;return s(this,function(s){switch(s.label){case 0:if(null==e||null==e.deed||e.deed.size<=0)return[2];this._director.setLayer(e.mask),t=[],n=Array.from(e.deed.values()),r=n.length,o=0,s.label=1;case 1:return o<r?(i=n[o],c=i.base.id,null!=(u=this._tiles.get(c))?[3,3]:[4,this.fetch()]):[3,5];case 2:(u=s.sent()).init(i.base),this._tiles.set(c,u),s.label=3;case 3:t.push(this.execute(i)),s.label=4;case 4:return o++,[3,1];case 5:return[4,Promise.all(t)];case 6:return s.sent(),this._director.setLayer(!1),e.clear(),e=null,[2]}})})},t.prototype.execute=function(e){return c(this,void 0,Promise,function(){var t,n=this;return s(this,function(){return t=this._tiles.get(e.base.id),[2,new Promise(function(r){for(var o=cc.tween(t.node),i=0,c=0,s=e.seq;c<s.length;c++){var u=s[c];if(u.start>i){var a=u.start-i;o.delay(a),i+=a}i+=n._director.execute(o,u.type,u,t)}o.call(function(){return r()}),o.start()})]})})},t.prototype.maskActive=function(e){this.mask.active=e},i([v(cc.Node)],t.prototype,"mask",void 0),i([m],t)}(cc.Component);n.GridView=b,cc._RF.pop()},{"../../../cfg/PrefabCfg":"PrefabCfg","../../../comm/asset/AssetMgr":"AssetMgr","../../../comm/pool/CmptPool":"CmptPool","../../../comm/util/WaitUtil":"WaitUtil","../../../define/GridDefine":"GridDefine","../../../define/TileDefine":"TileDefine","../GridDirector":"GridDirector","./TileView":"TileView"}],LimitCheck:[function(e,t,n){"use strict";cc._RF.push(t,"2fcf8cbV9BB7aXaEEvyQ8Tw","LimitCheck");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.LimitCheck=void 0;var s=e("../../../comm/util/WorkChain"),u=e("../../../define/TileDefine"),a=e("../../act/TileSelect"),l=e("../../mvc/GridCmd"),p=function(e){function t(){var t=e.call(this)||this;return t._process=null,t._process=new f,t._process.push(new h),t._process.push(new d),t._process.push(new y),t._process.push(new _),t._process.push(new m),t}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){return c(this,function(t){switch(t.label){case 0:return[4,this._process.execute(e)];case 1:return[2,t.sent()]}})})},t}(s.WorkChain);n.LimitCheck=p;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){var t;return c(this,function(){return e.from&&(t=e.to.tile.id)==e.from.tile.id?(cc.log("\u53d6\u6d88",t),e.load.push((new l.GridCmd).add(e.from.tile,new a.TileSelect(!1))),e.from=null,e.to=null,[2,!1]):[2,!0]})})},t}(s.WorkChain),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){return c(this,function(){return e.to.tile.group==u.TileGroup.Block?(e.to=null,[2,!1]):[2,!0]})})},t}(s.WorkChain),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){return c(this,function(){return e.to.tile.group!=u.TileGroup.Item||null!=e.from&&e.from.tile.group==u.TileGroup.Player?[2,!0]:(e.to=null,[2,!1])})})},t}(s.WorkChain),y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(){return i(this,void 0,Promise,function(){return c(this,function(){return[2,!0]})})},t}(s.WorkChain),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){return c(this,function(){return e.to.tile.group==u.TileGroup.Enemy?(e.to=null,[2,!1]):[2,!0]})})},t}(s.WorkChain),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){var t,n;return c(this,function(){return(t=e.to.tile).group==u.TileGroup.Player&&t.cd>0?[2,!1]:e.from&&t.group==u.TileGroup.Player?((n=new l.GridCmd).add(e.from.tile,new a.TileSelect(!1)),n.add(t,new a.TileSelect(!0)),e.load.push(n),e.from=e.to,e.to=null,[2,!1]):[2,!0]})})},t}(s.WorkChain);cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/TileDefine":"TileDefine","../../act/TileSelect":"TileSelect","../../mvc/GridCmd":"GridCmd"}],Loading:[function(e,t,n){"use strict";cc._RF.push(t,"d7359Fqc0NP3ZXYGIlHenol","Loading");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.Loading=void 0;var c=e("../cfg/AudioCfg"),s=e("../comm/audio/BgmAudio"),u=e("../comm/cmpt/Spine"),a=cc._decorator,l=a.ccclass,p=(a.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._spine=null,t}return o(t,e),t.prototype.onLoad=function(){this._spine=this.getComponentInChildren(u.Spine),this._spine.node.active=!1},t.prototype.onEnable=function(){cc.director.preloadScene("Main"),s.BgmAudio.inst().play(c.AudioSrc.Opening),this._spine.node.active=!0,this._spine.playOnce("OpeningV").then(function(){cc.director.loadScene("Main")})},i([l],t)}(cc.Component));n.Loading=p,cc._RF.pop()},{"../cfg/AudioCfg":"AudioCfg","../comm/audio/BgmAudio":"BgmAudio","../comm/cmpt/Spine":"Spine"}],LoseView:[function(e,t,n){"use strict";cc._RF.push(t,"97bcd7iKBRCPZ5+7vQbhzPN","LoseView");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.LoseView=void 0;var u=e("../../../cfg/AudioCfg"),a=e("../../../comm/asset/AssetMgr"),l=e("../../../comm/audio/SfxAudio"),p=e("../../../comm/util/WaitUtil"),f=cc._decorator,h=f.ccclass,d=(f.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onLoad=function(){this.node.active=!1,this.node.x=0},t.prototype.play=function(){return c(this,void 0,Promise,function(){var e,t;return s(this,function(n){switch(n.label){case 0:return t=(e=l.SfxAudio.inst()).play,[4,a.AssetMgr.inst().loadAsset(u.AudioSrc.Lose,cc.AudioClip,!0)];case 1:return t.apply(e,[n.sent()]),this.node.active=!0,[4,p.WaitUtil.waitSec(2.5)];case 2:return n.sent(),[2]}})})},i([h],t)}(cc.Component));n.LoseView=d,cc._RF.pop()},{"../../../cfg/AudioCfg":"AudioCfg","../../../comm/asset/AssetMgr":"AssetMgr","../../../comm/audio/SfxAudio":"SfxAudio","../../../comm/util/WaitUtil":"WaitUtil"}],MoveCheck:[function(e,t,n){"use strict";cc._RF.push(t,"300f4990P5AZoRi8S2qV3li","MoveCheck");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.MoveCheck=void 0;var s=e("../../../comm/util/WorkChain"),u=e("../../../define/TileDefine"),a=e("../../act/TileCd"),l=e("../../act/TileMove"),p=e("../../act/TileSkill"),f=e("../../mvc/GridCmd"),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){var t,n,r,o,i,s;return c(this,function(){if(t=e.from.pos,n=e.from.tile,r=e.to.pos,o=e.to.tile,n.group==u.TileGroup.Player){switch(i=new f.GridCmd,s=!0,o.group){case u.TileGroup.Norm:cc.log("\u79fb\u52d5",o.id,t),i.add(o,new l.TileMove(t)),e.model.setTile(t,o);break;case u.TileGroup.Skill:cc.log("\u6280\u80fd",o.id,o.type),i.add(o,new p.TileSkill(o.type)),e.model.setTile(t,null);break;default:cc.error("\u932f\u8aa4\u7684\u79fb\u52d5\u76ee\u6a19",n.id,o.id),e.from=null,e.to=null,s=!1}return s&&(cc.log("\u79fb\u52d5",n.id,r),i.add(n,new l.TileMove(r)),e.model.setTile(r,n),i.add(n,new a.TileCd),e.skip.push(n.id)),e.load.push(i),[2,s]}return[2,!0]})})},t}(s.WorkChain);n.MoveCheck=h,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/TileDefine":"TileDefine","../../act/TileCd":"TileCd","../../act/TileMove":"TileMove","../../act/TileSkill":"TileSkill","../../mvc/GridCmd":"GridCmd"}],NormAtk:[function(e,t,n){"use strict";cc._RF.push(t,"fd3d2AM3MxPEbfyiRLd/F4U","NormAtk");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.NormAtk=void 0;var s=e("../../../comm/util/WorkChain"),u=e("../../../define/GridDefine"),a=e("../../../define/TileDefine"),l=e("../../act/TileDie"),p=e("../../act/TileHit"),f=e("../../mvc/GridCmd"),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._param=null,t._cmd=null,t}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){var t=this;return c(this,function(){return this._param=e,this._cmd=new f.GridCmd,e.atkers.forEach(function(e){return Object.values(u.FOUR_DIR).forEach(function(n){return t.attack(e,n)})}),this._cmd.deed.size>0&&e.load.push(this._cmd),[2,!0]})})},t.prototype.attack=function(e,t){var n=e.pos.x+t.x,r=e.pos.y+t.y,o=this._param.model.getTile({x:n,y:r});if(o&&o.group==a.TileGroup.Enemy){var i=e.atk-o.def;i=i.limit(1,e.atk),o.decHp(i),this._cmd.add(o,new p.TileHit(i)),cc.log(e.id+"\u666e\u653b"+o.id+", \u50b7\u5bb3"+i+", \u5269\u8840"+o.currHp,e.pos,e.type,o.pos,o.type),this.dead(o)}},t.prototype.dead=function(e){e.currHp<=0&&(this._cmd.add(e,new l.TileDie),this._param.model.setTile(e.pos,null),cc.log(e.id+"\u6b7b\u4ea1",e.pos))},t}(s.WorkChain);n.NormAtk=h,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/GridDefine":"GridDefine","../../../define/TileDefine":"TileDefine","../../act/TileDie":"TileDie","../../act/TileHit":"TileHit","../../mvc/GridCmd":"GridCmd"}],NormPort:[function(e,t,n){"use strict";cc._RF.push(t,"7141cQTxgJIR6wpliuAoeLc","NormPort");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.NormPort=void 0;var s=e("../../../comm/util/WorkChain"),u=e("../../../define/TileDefine"),a=e("../base/ComboWork"),l=e("../base/CrushWork"),p=e("../base/DropWork"),f=e("../base/SlipWork"),h=e("../base/StuffWork"),d=e("../battle/NormAtk"),y=function(e){function t(){var t=e.call(this)||this;return t._process=null,t._process=new l.CrushWork,t._process.push(new d.NormAtk),t._process.push(new p.DropWork),t._process.push(new h.StuffWork),t._process.push(new f.SlipWork),t._process.push(new a.ComboWork),t}return o(t,e),t.prototype.clear=function(e){e.changes=[],e.finished=!1,e.atkers=[]},t.prototype.business=function(e,t){return void 0===t&&(t=!1),i(this,void 0,Promise,function(){return c(this,function(n){switch(n.label){case 0:0==t&&(this.clear(e),[e.first,e.second].forEach(function(t){t&&t.group==u.TileGroup.Norm&&e.changes.push(t.pos)})),n.label=1;case 1:return e.finished=!1,[4,this._process.execute(e)];case 2:n.sent(),n.label=3;case 3:if(!e.finished)return[3,1];n.label=4;case 4:return[2,!0]}})})},t}(s.WorkChain);n.NormPort=y,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/TileDefine":"TileDefine","../base/ComboWork":"ComboWork","../base/CrushWork":"CrushWork","../base/DropWork":"DropWork","../base/SlipWork":"SlipWork","../base/StuffWork":"StuffWork","../battle/NormAtk":"NormAtk"}],NumExtend:[function(e,t){"use strict";cc._RF.push(t,"9da3fiOvjJBHLJ6VBAtaqTo","NumExtend"),Number.prototype.limit=function(e,t){var n=this.valueOf();return n>=t?t:n<=e?e:n},cc._RF.pop()},{}],ObjPool:[function(e,t,n){"use strict";cc._RF.push(t,"db7b8tyFNdBU67twUTGGDzS","ObjPool");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.ObjPool=void 0;var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._pool=new Map,t}return o(t,e),t.prototype.onDestroy=function(){var e=this;Array.from(this._pool.keys()).forEach(function(t){return e.clear(t)},this),this._pool.clear()},t.prototype.clear=function(e){var t,n=this._pool.get(e);if(n)for(var r=0,o=n;r<o.length;r++){var i=o[r];null===(t=i)||void 0===t||t.destroy(),i=null}n=[],this._pool.delete(e)},t.prototype.size=function(e){var t,n;return null!==(n=null===(t=this._pool.get(e))||void 0===t?void 0:t.length)&&void 0!==n?n:0},t.prototype.fetch=function(e){return this.size(e)>0?this._pool.get(e).shift():null},t.prototype.recycle=function(e,t){var n,r;if(e&&t){var o=this._pool.get(e);if(null==o)o=[],this._pool.set(e,o);else if(-1!=o.indexOf(t))return null===(n=t)||void 0===n||n.destroy(),t=null,!1;return null===(r=t)||void 0===r||r.removeFromParent(!1),o.push(t),!0}return!1},t}(e("../util/Singleton").Singleton);n.ObjPool=i,cc._RF.pop()},{"../util/Singleton":"Singleton"}],PlayerPort:[function(e,t,n){"use strict";cc._RF.push(t,"043eePYxJJAsYkOiTOasC+u","PlayerPort");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.PlayerPort=void 0;var s=e("../../../comm/util/WorkChain"),u=e("../../../define/TileDefine"),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.clear=function(e){e.changes=[],e.finished=!1,e.atkers=[]},t.prototype.business=function(e){return i(this,void 0,Promise,function(){return c(this,function(){return this.clear(e),[e.first,e.second].forEach(function(e){e&&e.group==u.TileGroup.Player&&(e.cooldown(),cc.log("\u51b7\u537b",e.id,e.cd))}),[2,!0]})})},t}(s.WorkChain);n.PlayerPort=a,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/TileDefine":"TileDefine"}],PrefabCfg:[function(e,t,n){"use strict";cc._RF.push(t,"6bb16BgRM5PfJJRz2ZnSfUJ","PrefabCfg"),Object.defineProperty(n,"__esModule",{value:!0}),n.PrefabSrc=void 0,function(e){e.Tile="Tile/?bundle=prefab",e.CrushH="Particle_12/?bundle=prefab",e.CrushV="Particle_13/?bundle=prefab",e.Cross="Particle_14/?bundle=prefab",e.Thunder="Particle_15/?bundle=prefab",e.Cyclone="Particle_16/?bundle=prefab",e.WarriorAtk="Particle_01/?bundle=prefab",e.ArcherAtk="Particle_02/?bundle=prefab",e.ArmorAtk="Particle_03/?bundle=prefab"}(n.PrefabSrc||(n.PrefabSrc={})),cc._RF.pop()},{}],RandUtil:[function(e,t,n){"use strict";cc._RF.push(t,"79b32YCoAlKLK/buiU4J3UP","RandUtil"),Object.defineProperty(n,"__esModule",{value:!0}),n.RandUtil=void 0;var r=function(){function e(){}return e.randFloat=function(e,t){return void 0===t&&(t=0),Math.random()*(e-t)+t},e.randInt=function(e,t){return void 0===t&&(t=0),Math.floor(this.randFloat(Math.floor(e),Math.ceil(t)))},e.randRate=function(e){return this.randFloat(100)<e},e.randTypes=function(e){return e[this.randInt(e.length)]},e.randWeights=function(e){var t=0;e.forEach(function(e){return t+=e});for(var n=this.randFloat(t),r=0,o=e.length,i=0;i<o;i++)if((r+=e[i])>n)return i;return o-1},e.shuffle=function(e){for(var t,n=e.length,r=0;r<n;r++){var o=this.randInt(n);t=[e[r],e[o]],e[o]=t[0],e[r]=t[1]}return e},e}();n.RandUtil=r,cc._RF.pop()},{}],RecBtnUI:[function(e,t,n){"use strict";cc._RF.push(t,"44558n3D3VP+o5qUxtUIIV1","RecBtnUI");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.RecBtnUI=void 0;var c=e("../../comm/cmpt/ui/DutyUI"),s=cc._decorator,u=s.ccclass,a=(s.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onClick=function(){this.call()},i([u],t)}(c.DutyUI));n.RecBtnUI=a,cc._RF.pop()},{"../../comm/cmpt/ui/DutyUI":"DutyUI"}],RecUI:[function(e,t,n){"use strict";cc._RF.push(t,"792daYeevtG/7VBbqtC09t6","RecUI");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.RuleUI=void 0;var c=e("../../comm/cmpt/ui/UIBase"),s=e("../../comm/util/SaveUtil"),u=cc._decorator,a=u.ccclass,l=u.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lab=null,t}return o(t,e),t.prototype.onEnable=function(){var e=s.SaveUtil.load("MAX");this.lab.string=null!=e?e:"0"},t.prototype.onClose=function(){this.hide()},i([l(cc.Label)],t.prototype,"lab",void 0),i([a],t)}(c.UIBase);n.RuleUI=p,cc._RF.pop()},{"../../comm/cmpt/ui/UIBase":"UIBase","../../comm/util/SaveUtil":"SaveUtil"}],ReplayFx:[function(e,t,n){"use strict";cc._RF.push(t,"810b54UfxdCb7LQo1nXfYSm","ReplayFx");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.ReplayFx=void 0;var c=cc._decorator,s=c.ccclass,u=c.property,a=c.menu,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p3d=[],t.p2d=[],t.spines=[],t.anim=[],t}return o(t,e),Object.defineProperty(t.prototype,"refresh",{get:function(){return!1},set:function(){this.search()},enumerable:!1,configurable:!0}),t.prototype.clear=function(){this.p3d=[],this.p2d=[],this.spines=[],this.anim=[]},t.prototype.search=function(){this.clear();var e=function(e){return this.getComponentsInChildren(e).filter(function(e){return e.enabled})}.bind(this);this.p3d=e(cc.ParticleSystem3D),this.p2d=e(cc.ParticleSystem),this.spines=e(sp.Skeleton),this.anim=e(cc.Animation)},t.prototype.play=function(){this.stop(),this.p3d.forEach(function(e){return e.play()}),this.p2d.forEach(function(e){return e.resetSystem()}),this.anim.forEach(function(e){return e.play()}),this.spines.forEach(function(e){e.setAnimation(0,e.defaultAnimation,e.loop),e.node.active=!0}),this.node.active=!0},t.prototype.stop=function(){this.node.active=!1,this.p3d.forEach(function(e){return e.stop()}),this.p2d.forEach(function(e){return e.stopSystem()}),this.spines.forEach(function(e){return e.node.active=!1}),this.anim.forEach(function(e){return e.stop()})},i([u(cc.Boolean)],t.prototype,"refresh",null),i([u([cc.ParticleSystem3D])],t.prototype,"p3d",void 0),i([u([cc.ParticleSystem])],t.prototype,"p2d",void 0),i([u([sp.Skeleton])],t.prototype,"spines",void 0),i([u([cc.Animation])],t.prototype,"anim",void 0),i([s,a("replay fx")],t)}(cc.Component);n.ReplayFx=l,cc._RF.pop()},{}],ResetWork:[function(e,t,n){"use strict";cc._RF.push(t,"600e1k+aphOmqx4z7Jv5v81","ResetWork");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ResetWork=void 0;var s=e("../../../define/GridDefine"),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){return c(this,function(){return s.FOR_COL_ROW(function(t){var n=e.model.getTile(t);n&&n.clear()}),[2,!0]})})},t}(e("../../../comm/util/WorkChain").WorkChain);n.ResetWork=u,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/GridDefine":"GridDefine"}],RuleBtnUI:[function(e,t,n){"use strict";cc._RF.push(t,"c1413eVuWxJ/Ze8LP0y3Uzc","RuleBtnUI");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.RuleBtnUI=void 0;var c=e("../../comm/cmpt/ui/DutyUI"),s=cc._decorator,u=s.ccclass,a=(s.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onClick=function(){this.call()},i([u],t)}(c.DutyUI));n.RuleBtnUI=a,cc._RF.pop()},{"../../comm/cmpt/ui/DutyUI":"DutyUI"}],RuleUI:[function(e,t,n){"use strict";cc._RF.push(t,"900a21C3RBEAasfd8EGKHOk","RuleUI");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.RuleUI=void 0;var c=e("../../comm/cmpt/ui/UIBase"),s=cc._decorator,u=s.ccclass,a=(s.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onClose=function(){this.hide()},i([u],t)}(c.UIBase));n.RuleUI=a,cc._RF.pop()},{"../../comm/cmpt/ui/UIBase":"UIBase"}],RuleView:[function(e,t,n){"use strict";cc._RF.push(t,"940daGmeGREIqPxURKgHcuJ","RuleView");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.RuleView=void 0;var u=e("../../../cfg/AudioCfg"),a=e("../../../cfg/TextureCfg"),l=e("../../../comm/asset/AssetMgr"),p=e("../../../comm/audio/SfxAudio"),f=e("../../../define/TileDefine"),h=cc._decorator,d=h.ccclass,y=h.property,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=null,t.num=null,t._finished=!1,t.tileType=f.TileType.None,t.tileNum=0,t}return o(t,e),t.prototype.clear=function(){this._finished=!1,this.node.active=!1,this.setColor()},t.prototype.setColor=function(){var e=this._finished?cc.Color.BLACK:cc.Color.WHITE;this.type.node.color=e,this.num.node.color=e,this._finished&&l.AssetMgr.inst().loadAsset(u.AudioSrc.Rule,cc.AudioClip,!0).then(function(e){return p.SfxAudio.inst().play(e)})},t.prototype.setNum=function(e){this.num.string="x"+e.limit(0,Number.MAX_VALUE),this.tileNum=e,e<=0&&0==this._finished&&(this._finished=!0,this.setColor())},t.prototype.init=function(e,t){return c(this,void 0,Promise,function(){var n,r;return s(this,function(o){switch(o.label){case 0:return this.clear(),e==f.TileType.None?[3,2]:(this.setNum(t),n=a.TextureSrc[f.TileType[e]],r=this.type,[4,l.AssetMgr.inst().loadAsset(n,cc.SpriteFrame,!0)]);case 1:r.spriteFrame=o.sent(),t>0&&(this.node.active=!0),this.tileType=e,this.tileNum=t,o.label=2;case 2:return[2]}})})},i([y(cc.Sprite)],t.prototype,"type",void 0),i([y(cc.Label)],t.prototype,"num",void 0),i([d],t)}(cc.Component);n.RuleView=_,cc._RF.pop()},{"../../../cfg/AudioCfg":"AudioCfg","../../../cfg/TextureCfg":"TextureCfg","../../../comm/asset/AssetMgr":"AssetMgr","../../../comm/audio/SfxAudio":"SfxAudio","../../../define/TileDefine":"TileDefine"}],SaveUtil:[function(e,t,n){"use strict";cc._RF.push(t,"e93efzGEqpP1r0gsQ80a5w6","SaveUtil"),Object.defineProperty(n,"__esModule",{value:!0}),n.SaveUtil=void 0;var r=function(){function e(){}return e.save=function(e,t){cc.sys.localStorage.setItem(e,JSON.stringify(t))},e.load=function(e){return JSON.parse(cc.sys.localStorage.getItem(e))},e}();n.SaveUtil=r,cc._RF.pop()},{}],SecondCheck:[function(e,t,n){"use strict";cc._RF.push(t,"2c31e5ZleBA0rUwsq88kohA","SecondCheck");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.SecondCheck=void 0;var s=e("../../../comm/util/WorkChain"),u=e("../../../define/TileDefine"),a=e("../../act/TileSelect"),l=e("../../mvc/GridCmd"),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){var t;return c(this,function(){return t=new l.GridCmd,1==Math.abs(e.to.pos.x-e.from.pos.x)+Math.abs(e.to.pos.y-e.from.pos.y)||e.from.tile.group==u.TileGroup.Player?(cc.log("\u8907\u9078",e.to.tile.id),t.add(e.from.tile,new a.TileSelect(!1)),t.add(e.to.tile,new a.TileSelect(!1)),e.load.push(t),[2,!0]):(cc.log("\u91cd\u9078",e.to.tile.id),t.add(e.from.tile,new a.TileSelect(!1)),t.add(e.to.tile,new a.TileSelect(!0)),e.from=e.to,e.to=null,e.load.push(t),[2,!1])})})},t}(s.WorkChain);n.SecondCheck=p,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/TileDefine":"TileDefine","../../act/TileSelect":"TileSelect","../../mvc/GridCmd":"GridCmd"}],SelectHandler:[function(e,t,n){"use strict";cc._RF.push(t,"e6b9dQPszZPmLIYxwML5NLk","SelectHandler");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.SelectHandler=void 0;var s=e("../../comm/util/Singleton"),u=e("../mvc/GridCmd"),a=e("../../define/GridDefine"),l=e("./port/PlayerPort"),p=e("./port/NormPort"),f=e("./port/EnemyPort"),h=e("../../define/TileDefine"),d=e("../act/TileNext"),y=e("./check/LimitCheck"),_=e("./check/FirstCheck"),m=e("./check/SecondCheck"),v=e("./check/SwapCheck"),b=e("./check/MoveCheck"),g=e("./base/ResetWork"),w=e("./port/SkillPort"),T=e("./battle/UltAtk"),x=function(e){function t(){var t=e.call(this)||this;return t._from=null,t._check=null,t._port=null,t._ultimate=null,t._skip=[],t._check=new y.LimitCheck,t._check.push(new _.FirstCheck),t._check.push(new m.SecondCheck),t._check.push(new v.SwapCheck),t._check.push(new b.MoveCheck),t._port=new g.ResetWork,t._port.push(new w.SkillPort),t._port.push(new p.NormPort),t._port.push(new l.PlayerPort),t._port.push(new f.EnemyPort),t._ultimate=new g.ResetWork,t._ultimate.push(new T.UltAtk),t._ultimate.push(new p.NormPort),t}return o(t,e),Object.defineProperty(t.prototype,"selected",{get:function(){return this._from?this._from.pos:null},enumerable:!1,configurable:!0}),t.prototype.onDestroy=function(){this._from=null},t.prototype.execute=function(e,t){return i(this,void 0,Promise,function(){var n,r,o;return c(this,function(i){switch(i.label){case 0:return n=[],this._skip=[],r={model:e,load:n,from:this._from,to:{pos:t,tile:e.getTile(t)},skip:this._skip},[4,this._check.execute(r)];case 1:return o=i.sent(),this._from=r.from,o?[4,this._port.execute({model:e,load:n,first:r.from.tile,second:r.to.tile,skip:this._skip})]:[3,3];case 2:i.sent(),this._from=null,this.nextRound(e,n),i.label=3;case 3:return[2,n]}})})},t.prototype.executeUlt=function(e){return i(this,void 0,Promise,function(){var t;return c(this,function(n){switch(n.label){case 0:return t=[],this._skip=[],[4,this._ultimate.execute({model:e,load:t,first:null,second:null,skip:this._skip})];case 1:return n.sent(),this._from=null,this.nextRound(e,t),[2,t]}})})},t.prototype.nextRound=function(e,t){return i(this,void 0,Promise,function(){var n,r;return c(this,function(){return n=new u.GridCmd,r=this,a.FOR_COL_ROW(function(t){var o=e.getTile(t);if(o&&(o.group==h.TileGroup.Player||o.group==h.TileGroup.Enemy)){var i=-1==r._skip.indexOf(o.id);o.nextRound(i),n.add(o,new d.TileNext(i))}}),cc.log("\u6b21\u56de"),n.deed.size>0&&(t.push(n),n.mask=!1),[2]})})},t}(s.Singleton);n.SelectHandler=x,cc._RF.pop()},{"../../comm/util/Singleton":"Singleton","../../define/GridDefine":"GridDefine","../../define/TileDefine":"TileDefine","../act/TileNext":"TileNext","../mvc/GridCmd":"GridCmd","./base/ResetWork":"ResetWork","./battle/UltAtk":"UltAtk","./check/FirstCheck":"FirstCheck","./check/LimitCheck":"LimitCheck","./check/MoveCheck":"MoveCheck","./check/SecondCheck":"SecondCheck","./check/SwapCheck":"SwapCheck","./port/EnemyPort":"EnemyPort","./port/NormPort":"NormPort","./port/PlayerPort":"PlayerPort","./port/SkillPort":"SkillPort"}],SfxAudio:[function(e,t,n){"use strict";cc._RF.push(t,"99caf4m2qFHkYEIv77izdO1","SfxAudio");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.SfxAudio=void 0;var s=e("../asset/AssetMgr"),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),Object.defineProperty(t.prototype,"vol",{get:function(){return cc.audioEngine.getEffectsVolume()},set:function(e){cc.audioEngine.setEffectsVolume(e.limit(0,1))},enumerable:!1,configurable:!0}),t.prototype.onDestroy=function(){},t.prototype.play=function(e,t){return i(this,void 0,Promise,function(){var n,r,o;return c(this,function(i){switch(i.label){case 0:return e instanceof cc.AudioClip?(r=e,[3,3]):[3,1];case 1:return[4,s.AssetMgr.inst().loadAsset(e,cc.AudioClip,!0)];case 2:r=i.sent(),i.label=3;case 3:return n=r,o=cc.audioEngine.playEffect(n,!1),t&&cc.audioEngine.setFinishCallback(o,t),[2,o]}})})},t.prototype.stop=function(e){cc.audioEngine.stopEffect(e)},t.prototype.stopAll=function(){cc.audioEngine.stopAllEffects()},t.prototype.pause=function(e){cc.audioEngine.pauseEffect(e)},t.prototype.pauseAll=function(){cc.audioEngine.pauseAllEffects()},t.prototype.resume=function(e){cc.audioEngine.resumeEffect(e)},t.prototype.resumeAll=function(){cc.audioEngine.resumeAllEffects()},t}(e("../util/Singleton").Singleton);n.SfxAudio=u,cc._RF.pop()},{"../asset/AssetMgr":"AssetMgr","../util/Singleton":"Singleton"}],SfxView:[function(e,t,n){"use strict";cc._RF.push(t,"9ef1b+YeLhB3IvprA4IH+hO","SfxView");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.SfxView=void 0;var u=e("../../../cfg/PrefabCfg"),a=e("../../../comm/asset/AssetMgr"),l=e("../../../comm/cmpt/ReplayFx"),p=e("../../../comm/pool/ObjPool"),f=e("../../../comm/util/WaitUtil"),h=e("../../../define/GridDefine"),d=cc._decorator,y=d.ccclass,_=d.property,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._pool=new p.ObjPool,t.host=null,t}var n;return o(t,e),n=t,Object.defineProperty(t,"inst",{get:function(){return this._inst},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){n._inst=this,this.host.anchorX=0,this.host.anchorY=0,this.host.x=-h.GRID_W/2,this.host.y=-h.GRID_H/2,this.host.width=h.GRID_W,this.host.height=h.GRID_H},t.prototype.playSfx=function(e,t,n){return c(this,void 0,Promise,function(){var r,o,i,c;return s(this,function(s){switch(s.label){case 0:return[4,this._pool.fetch(e)];case 1:return null!=(r=s.sent())?[3,3]:(i=(o=cc).instantiate,[4,a.AssetMgr.inst().loadAsset(e,cc.Prefab,!0)]);case 2:r=i.apply(o,[s.sent()]),s.label=3;case 3:return c=r.getComponent(l.ReplayFx),r.setParent(this.host),r.active=!1,r.setPosition(t),c.play(),[4,f.WaitUtil.waitMs(n,c)];case 4:return s.sent(),this._pool.recycle(e,r),[2]}})})},t.prototype.showCrushH=function(e){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.playSfx(u.PrefabSrc.CrushH,e,500)];case 1:return t.sent(),[2]}})})},t.prototype.showCrushV=function(e){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.playSfx(u.PrefabSrc.CrushV,e,500)];case 1:return t.sent(),[2]}})})},t.prototype.showCross=function(e){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.playSfx(u.PrefabSrc.Cross,e,500)];case 1:return t.sent(),[2]}})})},t.prototype.showThunder=function(e){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.playSfx(u.PrefabSrc.Thunder,e,500)];case 1:return t.sent(),[2]}})})},t.prototype.showCyclone=function(e){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.playSfx(u.PrefabSrc.Cyclone,e,500)];case 1:return t.sent(),[2]}})})},t.prototype.showWarriorAtk=function(e){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.playSfx(u.PrefabSrc.WarriorAtk,e,500)];case 1:return t.sent(),[2]}})})},t.prototype.showArcherAtk=function(e){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.playSfx(u.PrefabSrc.ArcherAtk,e,500)];case 1:return t.sent(),[2]}})})},t.prototype.showArmorAtk=function(e){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.playSfx(u.PrefabSrc.ArmorAtk,e,500)];case 1:return t.sent(),[2]}})})},t._inst=null,i([_(cc.Node)],t.prototype,"host",void 0),n=i([y],t)}(cc.Component);n.SfxView=m,cc._RF.pop()},{"../../../cfg/PrefabCfg":"PrefabCfg","../../../comm/asset/AssetMgr":"AssetMgr","../../../comm/cmpt/ReplayFx":"ReplayFx","../../../comm/pool/ObjPool":"ObjPool","../../../comm/util/WaitUtil":"WaitUtil","../../../define/GridDefine":"GridDefine"}],Shake:[function(e,t,n){"use strict";cc._RF.push(t,"0424cskBOJJkbUlEOm43MXI","Shake");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.Shake=void 0;var c=cc._decorator,s=c.ccclass,u=(c.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._handler=-1,t}return o(t,e),t.prototype.play=function(e){var t=this;this.stop(),e>0&&(this.node.runAction(cc.repeatForever(cc.sequence(cc.moveTo(.02,cc.v2(5,7)),cc.moveTo(.02,cc.v2(-6,7)),cc.moveTo(.02,cc.v2(-13,3)),cc.moveTo(.02,cc.v2(3,-6)),cc.moveTo(.02,cc.v2(-5,5)),cc.moveTo(.02,cc.v2(2,-8)),cc.moveTo(.02,cc.v2(-8,-10)),cc.moveTo(.02,cc.v2(3,10)),cc.moveTo(.02,cc.v2(0,0))))),this._handler=window.setTimeout(function(){return t.stop()},e))},t.prototype.stop=function(){-1!=this._handler&&(this.node.stopAllActions(),this.node.setPosition(cc.Vec2.ZERO),window.clearTimeout(this._handler),this._handler=-1)},i([s],t)}(cc.Component));n.Shake=u,cc._RF.pop()},{}],SimulateFx:[function(e,t){"use strict";cc._RF.push(t,"81e43e21cpOopyvA3GZGZo2","SimulateFx"),cc._RF.pop()},{}],Singleton:[function(e,t,n){"use strict";cc._RF.push(t,"6e9781YJWxMvL+U3Auu6onm","Singleton"),Object.defineProperty(n,"__esModule",{value:!0}),n.Singleton=void 0;var r=function(){function e(){}return e.inst=function(){var e;return null!==(e=this._inst)&&void 0!==e||(this._inst=new this),this._inst},e.destroy=function(){this._inst.onDestroy(),this._inst=null},e}();n.Singleton=r,cc._RF.pop()},{}],SkillAtk:[function(e,t,n){"use strict";cc._RF.push(t,"f0fa5uJFjhFiYE+qkkYZA8r","SkillAtk");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.SkillAtk=void 0;var s=e("../../../comm/util/RandUtil"),u=e("../../../comm/util/WorkChain"),a=e("../../../define/TileDefine"),l=e("../../act/TileDie"),p=e("../../act/TileHit"),f=e("../../mvc/GridCmd"),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._param=null,t._cmd=null,t}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){var t=this;return c(this,function(){return this._param=e,this._cmd=new f.GridCmd,e.atkers.forEach(function(e){switch(e.type){case a.TileType.Cross:t.cross(e);break;case a.TileType.Thunder:t.thunder(e);break;case a.TileType.Cyclone:t.cyclone(e)}}),this._cmd.deed.size>0&&e.load.push(this._cmd),[2,!0]})})},t.prototype.cross=function(e){for(var t=-3;t<=3;t++)this.attack(e,{x:0,y:t}),this.attack(e,{x:t,y:0})},t.prototype.thunder=function(e){for(var t=s.RandUtil.shuffle(this._param.model.enemies),n=t.length.limit(0,3),r=0;r<n;r++){var o=t.shift();this.attack(e,{x:o.pos.x-e.pos.x,y:o.pos.y-e.pos.y})}},t.prototype.cyclone=function(e){for(var t=-2;t<=2;t++)for(var n=-2;n<=2;n++)this.attack(e,{x:t,y:n})},t.prototype.attack=function(e,t){var n=e.pos.x+t.x,r=e.pos.y+t.y,o=this._param.model.getTile({x:n,y:r});if(o){var i=0;switch(o.group){case a.TileGroup.Norm:case a.TileGroup.Enemy:i=(i=e.atk-o.def).limit(1,e.atk);break;case a.TileGroup.Block:i=1}i>0&&o.id>=0&&(o.decHp(i),this._cmd.add(o,new p.TileHit(i)),cc.log(e.id+"\u7279\u653b"+o.id+", \u50b7\u5bb3"+i+", \u5269\u8840"+o.currHp,e.pos,e.type,o.pos,o.type),this.dead(o))}},t.prototype.dead=function(e){e.currHp<=0&&(this._cmd.add(e,new l.TileDie),this._param.model.setTile(e.pos,null),cc.log(e.id+"\u6b7b\u4ea1",e.pos))},t}(u.WorkChain);n.SkillAtk=h,cc._RF.pop()},{"../../../comm/util/RandUtil":"RandUtil","../../../comm/util/WorkChain":"WorkChain","../../../define/TileDefine":"TileDefine","../../act/TileDie":"TileDie","../../act/TileHit":"TileHit","../../mvc/GridCmd":"GridCmd"}],SkillPort:[function(e,t,n){"use strict";cc._RF.push(t,"2276fICGTVFdL7TghRb2rbL","SkillPort");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.SkillPort=void 0;var s=e("../../../comm/util/WorkChain"),u=e("../../../define/TileDefine"),a=e("../battle/SkillAtk"),l=function(e){function t(){var t=e.call(this)||this;return t._process=null,t._process=new a.SkillAtk,t}return o(t,e),t.prototype.clear=function(e){e.changes=[],e.finished=!1,e.atkers=[]},t.prototype.business=function(e){return i(this,void 0,Promise,function(){return c(this,function(t){switch(t.label){case 0:return this.clear(e),[e.first,e.second].forEach(function(t){e.first.group==u.TileGroup.Player&&t&&t.group==u.TileGroup.Skill&&e.atkers.push(t)}),e.atkers.length>0?[4,this._process.execute(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2,!0]}})})},t}(s.WorkChain);n.SkillPort=l,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/TileDefine":"TileDefine","../battle/SkillAtk":"SkillAtk"}],SlipWork:[function(e,t,n){"use strict";cc._RF.push(t,"367acxTfcxPGqvBcT+FN7Io","SlipWork");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.SlipWork=void 0;var s=e("../../../comm/util/WorkChain"),u=e("../../../define/GridDefine"),a=e("../../act/TileSlip"),l=e("../../mvc/GridCmd"),p=e("./DropWork"),f=e("./StuffWork"),h=function(e){function t(){var t=e.call(this)||this;return t._param=null,t._process=null,t._process=new p.DropWork,t._process.push(new f.StuffWork),t}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){var t,n,r,o,i,s;return c(this,function(c){switch(c.label){case 0:this._param=e,t=0,c.label=1;case 1:if(!(t<u.GRID_ROW))return[3,8];n=0,c.label=2;case 2:return n<u.GRID_COL?(r={x:n,y:t},null==(o=e.model.getTile(r))||o.hold?[3,6]:(i=this.searchR(r)).length>0?(this.slip(o,i),[4,this._process.execute(e,n)]):[3,4]):[3,7];case 3:return c.sent(),[3,6];case 4:return(s=this.searchL(r)).length>0?(this.slip(o,s),[4,this._process.execute(e,n)]):[3,6];case 5:return c.sent(),[3,6];case 6:return n++,[3,2];case 7:return t++,[3,1];case 8:return[2,!0]}})})},t.prototype.searchR=function(e){return this.search({x:e.x+1,y:e.y-1})},t.prototype.searchL=function(e){return this.search({x:e.x-1,y:e.y-1})},t.prototype.search=function(e){var t=[];if(e.x<0||e.x>=u.GRID_COL||e.y<0||e.y>=u.GRID_ROW)return t;if(null==this._param.model.getTile(e)){t.push(e);var n=this.searchR(e);if(n&&n.length>0)return t.concat(n);var r=this.searchL(e);if(r&&r.length>0)return t.concat(r)}return t},t.prototype.slip=function(e,t){var n=new l.GridCmd;n.add(e,new a.TileSlip(t));var r=e.pos,o=t[t.length-1];this._param.model.setTile(o,e),this._param.model.setTile(r,null),this._param.changes.push(o),cc.log("\u5074\u6ed1",e.id,o,t),this._param.load.push(n)},t}(s.WorkChain);n.SlipWork=h,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/GridDefine":"GridDefine","../../act/TileSlip":"TileSlip","../../mvc/GridCmd":"GridCmd","./DropWork":"DropWork","./StuffWork":"StuffWork"}],SpinCfg:[function(e,t,n){"use strict";cc._RF.push(t,"c154aeIMtpKOahrfstnULHR","SpinCfg"),Object.defineProperty(n,"__esModule",{value:!0}),n.SpineSrc=void 0,function(e){e.Blue="tile/blue/SymbolH4/?bundle=spine",e.Green="tile/green/SymbolH5/?bundle=spine",e.Red="tile/red/SymbolH2/?bundle=spine",e.Yellow="tile/yellow/SymbolH1/?bundle=spine",e.Hero="tile/hero/SymbolW1/?bundle=spine"}(n.SpineSrc||(n.SpineSrc={})),cc._RF.pop()},{}],Spine:[function(e,t,n){"use strict";cc._RF.push(t,"08714MdqEBH0IBaVGzgaQ16","Spine");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.Spine=void 0;var u=e("../asset/AssetMgr"),a=e("../util/WaitUtil"),l=cc._decorator,p=l.ccclass,f=(l.property,l.requireComponent),h=l.menu,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._spine=null,t.key="",t}var n;return o(t,e),n=t,Object.defineProperty(t.prototype,"spine",{get:function(){var e;return null!==(e=this._spine)&&void 0!==e?e:this._spine=this.getComponent(sp.Skeleton)},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this._spine=this.getComponent(sp.Skeleton)},t.prototype.init=function(e){return c(this,void 0,Promise,function(){var t,n;return s(this,function(r){switch(r.label){case 0:return e instanceof sp.SkeletonData?(n=e,[3,3]):[3,1];case 1:return[4,u.AssetMgr.inst().loadAsset(e,sp.SkeletonData,!0)];case 2:n=r.sent(),r.label=3;case 3:return t=n,this.spine.skeletonData=t,[2]}})})},t.prototype.scale=function(e){this.spine.timeScale=e},t.prototype.stop=function(){this.spine.clearTrack(n.TRACK),this.spine.setToSetupPose(),this.key="",this.resume()},t.prototype.pause=function(){this.spine.paused=!0},t.prototype.resume=function(){this.spine.paused=!1},t.prototype.listen=function(e,t){e&&t&&this.spine.setTrackEventListener(e,function(e,n){return t(n.data.name)})},t.prototype.playOnce=function(e,t){return void 0===e&&(e=this.spine.defaultAnimation),c(this,void 0,Promise,function(){var r,o=this;return s(this,function(){return this.stop(),r=this.spine.setAnimation(n.TRACK,e,!1),this.listen(r,t),this.key=e,[2,new Promise(function(e){return c(o,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,a.WaitUtil.waitSec(r.animation.duration/this.spine.timeScale,this.spine)];case 1:return t.sent(),e(),[2]}})})})]})})},t.prototype.playLoop=function(e,t){void 0===e&&(e=this.spine.defaultAnimation),this.stop(),this.key=e,this.listen(this.spine.setAnimation(n.TRACK,e,!0),t)},t.prototype.playSteps=function(e,t){return c(this,void 0,Promise,function(){var r,o=this;return s(this,function(){return this.stop(),r=0,e.forEach(function(e){var i=o.spine.setAnimation(n.TRACK,e,!1);o.listen(i,t),r+=i.animation.duration},this),r>0?[2,new Promise(function(e){return c(o,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,a.WaitUtil.waitSec(r,this.spine)];case 1:return t.sent(),e(),[2]}})})})]:[2]})})},t.prototype.contain=function(e,t){var n=this.spine.attachUtil.generateAttachedNodes(e);n&&n.length>0&&(t.parent=n[0])},t.TRACK=99,n=i([p,f(sp.Skeleton),h("spine")],t)}(cc.Component);n.Spine=d,cc._RF.pop()},{"../asset/AssetMgr":"AssetMgr","../util/WaitUtil":"WaitUtil"}],StageCtrl:[function(e,t,n){"use strict";cc._RF.push(t,"986b6jCmJVPk5A8nf9uXyUO","StageCtrl");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.StageCtrl=void 0;var u=e("../../../cfg/AudioCfg"),a=e("../../../cfg/EventCfg"),l=e("../../../comm/asset/AssetMgr"),p=e("../../../comm/audio/BgmAudio"),f=e("../../../comm/audio/SfxAudio"),h=e("../../../comm/event/EventDecor"),d=e("../../../comm/util/SaveUtil"),y=e("../../../define/GameDefine"),_=e("../model/StageModel"),m=e("../view/StageView"),v=e("./GridCtrl"),b=cc._decorator,g=b.ccclass,w=(b.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._model=null,t._view=null,t}var n;return o(t,e),n=t,Object.defineProperty(t,"inst",{get:function(){return this._inst},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._model.data},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){n._inst=this},t.prototype.onEnable=function(){this._model=new _.StageModel,this._view=this.getComponentInChildren(m.StageView),this._view.init(this._model)},t.prototype.start=function(){this._model.setLv(y.START_STAGE),this.fight()},t.prototype.onDestroy=function(){this._model=null},t.prototype.crushed=function(e,t){this._model.decRule(e,t)&&this.win(),this._view.decRule(e,t)},t.prototype.win=function(){return c(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return this._model.directWin(),[4,this._view.playWin()];case 1:return e.sent(),this._model.incLv(),this.save(),[4,this.fight()];case 2:return e.sent(),[2]}})})},t.prototype.save=function(){var e=d.SaveUtil.load("MAX");e=null!=e?e:"0";var t=this._model.lv.value;t>e&&d.SaveUtil.save("MAX",t)},t.prototype.fight=function(){return c(this,void 0,Promise,function(){return s(this,function(){return l.AssetMgr.inst().loadAsset(u.AudioSrc.Begin,cc.AudioClip,!0).then(function(e){p.BgmAudio.inst().pause(),f.SfxAudio.inst().play(e,function(){return p.BgmAudio.inst().resume()})}),v.GridCtrl.inst.fight(),[2]})})},t.prototype.lose=function(){this._view.playLose()},t._inst=null,i([h.onEvent(a.EventSrc.Crushed)],t.prototype,"crushed",null),i([h.onEvent(a.EventSrc.DebugWin)],t.prototype,"win",null),i([h.onEvent(a.EventSrc.Lose)],t.prototype,"lose",null),n=i([g,h.onEnable()],t)}(cc.Component));n.StageCtrl=w,cc._RF.pop()},{"../../../cfg/AudioCfg":"AudioCfg","../../../cfg/EventCfg":"EventCfg","../../../comm/asset/AssetMgr":"AssetMgr","../../../comm/audio/BgmAudio":"BgmAudio","../../../comm/audio/SfxAudio":"SfxAudio","../../../comm/event/EventDecor":"EventDecor","../../../comm/util/SaveUtil":"SaveUtil","../../../define/GameDefine":"GameDefine","../model/StageModel":"StageModel","../view/StageView":"StageView","./GridCtrl":"GridCtrl"}],StageModel:[function(e,t,n){"use strict";cc._RF.push(t,"454dbsV8rdHl7uShXyaUZXT","StageModel"),Object.defineProperty(n,"__esModule",{value:!0}),n.StageModel=void 0;var r=e("../../../comm/util/DataDriven"),o=e("../../../define/GameDefine"),i=function(){function e(){var e=this;this.lv=new r.DataDriven(0),this.rules=new Map,this.lv.on(function(t){cc.log("\u5347\u7d1a",t),e.resetRules()})}return Object.defineProperty(e.prototype,"data",{get:function(){return o.STAGE_RULE[this.lv.value.limit(1,o.MAX_STAGE)]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"winner",{get:function(){return this.rules.size<=0},enumerable:!1,configurable:!0}),e.prototype.incLv=function(e){return void 0===e&&(e=1),this.setLv(this.lv.value+e)},e.prototype.setLv=function(e){return this.lv.value=e,e},e.prototype.resetRules=function(){var e=this,t=this.data.pass,n=Object.keys(t),r=Object.values(t);this.rules.clear(),n.forEach(function(t,n){var o=+r[n];o>0&&e.rules.set(+t,o)},this)},e.prototype.directWin=function(){this.rules.clear()},e.prototype.decRule=function(e,t){if(this.rules.has(e)){var n=this.rules.get(e);n-=t,this.rules.set(e,n),n<=0&&this.rules.delete(e)}return this.winner},e}();n.StageModel=i,cc._RF.pop()},{"../../../comm/util/DataDriven":"DataDriven","../../../define/GameDefine":"GameDefine"}],StageView:[function(e,t,n){"use strict";cc._RF.push(t,"62e50XJb9JPRIqvh1JCj1Wd","StageView");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.StageView=void 0;var u=e("./LoseView"),a=e("./RuleView"),l=e("./WinView"),p=cc._decorator,f=p.ccclass,h=p.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lv=null,t.rules=[],t.win=null,t.lose=null,t}return o(t,e),t.prototype.init=function(e){var t=this;e.lv.on(function(n){t.lv.string=n;var r=e.data.pass,o=Object.keys(r),i=Object.values(r);t.rules.forEach(function(e){var t,n,r=null!==(t=o.shift())&&void 0!==t?t:0,c=null!==(n=i.shift())&&void 0!==n?n:0;e.init(r,c)})})},t.prototype.playWin=function(){return c(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.win.play()];case 1:return e.sent(),[2]}})})},t.prototype.playLose=function(){return c(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.lose.play()];case 1:return e.sent(),[2]}})})},t.prototype.decRule=function(e,t){this.rules.forEach(function(n){if(n.tileType==e){var r=n.tileNum-t;n.setNum(r)}})},i([h(cc.Label)],t.prototype,"lv",void 0),i([h([a.RuleView])],t.prototype,"rules",void 0),i([h(l.WinView)],t.prototype,"win",void 0),i([h(u.LoseView)],t.prototype,"lose",void 0),i([f],t)}(cc.Component);n.StageView=d,cc._RF.pop()},{"./LoseView":"LoseView","./RuleView":"RuleView","./WinView":"WinView"}],StrExtend:[function(e,t){"use strict";cc._RF.push(t,"4625bxA4ShArqK9d0U3lpKY","StrExtend"),String.prototype.format=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.replace(/\{(\d+)\}/g,function(t,n){return e[n]})},String.prototype.exchange=function(e,t){return this.replace(new RegExp(e,"gm"),t)},cc._RF.pop()},{}],StuffWork:[function(e,t,n){"use strict";cc._RF.push(t,"885fdWjj1VM0JBwY5xiDr5B","StuffWork");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.StuffWork=void 0;var s=e("../../../define/GridDefine"),u=e("../../act/TileFall"),a=e("../../act/TileSpawn"),l=e("../../../comm/util/WorkChain"),p=e("../../mvc/model/TileModel"),f=e("../../mvc/GridCmd"),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e,t){return i(this,void 0,Promise,function(){var n;return c(this,function(){return n=new f.GridCmd,e.load.push(n),s.FOR_COL(function(r){if(!t||t==r){for(var o=0,i=0,c=s.GRID_ROW-1;c>=0;c--){var l={x:r,y:c};if((h=e.model.getTile(l))&&h.hold){i=c;break}}for(c=i;c<s.GRID_ROW;c++){var f={x:r,y:c};if(null==e.model.getTile(f)){var h=new p.TileModel;e.model.setTile(f,h),h.type=e.model.getRandType(),h.entry={x:r,y:s.GRID_ROW+o++},n.add(h,new a.TileSpawn),n.add(h,new u.TileFall(f)),e.changes.push(f),cc.log("\u586b\u88dc",h.id,h.type,f),e.skip.push(h.id)}}}}),[2,!0]})})},t}(l.WorkChain);n.StuffWork=h,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/GridDefine":"GridDefine","../../act/TileFall":"TileFall","../../act/TileSpawn":"TileSpawn","../../mvc/GridCmd":"GridCmd","../../mvc/model/TileModel":"TileModel"}],SwapCheck:[function(e,t,n){"use strict";cc._RF.push(t,"49fd5kpFr1Ikpz4WkzZFYRC","SwapCheck");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.SwapCheck=void 0;var s=e("../../../comm/util/WorkChain"),u=e("../../../define/TileDefine"),a=e("../../act/TileSwap"),l=e("../../mvc/GridCmd"),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){var t,n;return c(this,function(){return(t=e.from.tile.group)!=u.TileGroup.Norm&&t!=u.TileGroup.Skill||(this.swap(e),(n=e.model.isCrush(e.from.pos))||(n=e.model.isCrush(e.to.pos)),0!=n)?[2,!0]:(cc.log("\u5931\u6557",e.from.tile.id,e.to.tile.id),this.swap(e),e.from=null,e.to=null,[2,!1])})})},t.prototype.swap=function(e){cc.log("\u4e92\u63db",e.from.tile.id,e.to.tile.id);var t=new l.GridCmd;t.add(e.from.tile,new a.TileSwap(e.to.pos)),t.add(e.to.tile,new a.TileSwap(e.from.pos)),e.load.push(t),e.model.setTile(e.from.pos,e.to.tile),e.model.setTile(e.to.pos,e.from.tile);var n=e.from.pos;e.from.pos=e.to.pos,e.to.pos=n},t}(s.WorkChain);n.SwapCheck=p,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/TileDefine":"TileDefine","../../act/TileSwap":"TileSwap","../../mvc/GridCmd":"GridCmd"}],TextureCfg:[function(e,t,n){"use strict";cc._RF.push(t,"9df0efpjLJF5J9C+ixMeHm+","TextureCfg"),Object.defineProperty(n,"__esModule",{value:!0}),n.TextureSrc=void 0,function(e){e.Blue="tile/blue/?bundle=texture",e.Green="tile/green/?bundle=texture",e.Red="tile/red/?bundle=texture",e.Yellow="tile/yellow/?bundle=texture",e.Stone="tile/stone/?bundle=texture",e.Rock="tile/rock/?bundle=texture",e.Potion="tile/potion/?bundle=texture",e.Cross="tile/cross/?bundle=texture",e.Thunder="tile/thunder/?bundle=texture",e.Cyclone="tile/cyclone/?bundle=texture",e.Warrior="tile/warrior/?bundle=texture",e.Archer="tile/archer/?bundle=texture",e.Armor="tile/armor/?bundle=texture",e.Hero="tile/hero/?bundle=texture",e.PlayerHp="tile/hp-green/?bundle=texture",e.EnemyHp="tile/hp-red/?bundle=texture"}(n.TextureSrc||(n.TextureSrc={})),cc._RF.pop()},{}],TileAtk:[function(e,t,n){"use strict";cc._RF.push(t,"a4974403DpPe5/MJFkqdw3p","TileAtk");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TileAtk=void 0;var i=e("../../define/TileDefine"),c=function(e){function t(){return e.call(this)||this}return o(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return i.TileAct.Atk},enumerable:!1,configurable:!0}),t}(e("../mvc/GridCmd").TilePlay);n.TileAtk=c,cc._RF.pop()},{"../../define/TileDefine":"TileDefine","../mvc/GridCmd":"GridCmd"}],TileCd:[function(e,t,n){"use strict";cc._RF.push(t,"c450anAusFFPqsM9glbZvaJ","TileCd");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TileCd=void 0;var i=e("../../define/TileDefine"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return i.TileAct.Cd},enumerable:!1,configurable:!0}),t}(e("../mvc/GridCmd").TilePlay);n.TileCd=c,cc._RF.pop()},{"../../define/TileDefine":"TileDefine","../mvc/GridCmd":"GridCmd"}],TileCrush:[function(e,t,n){"use strict";cc._RF.push(t,"bc90dA8FS1N9b8WDSF8KC5q","TileCrush");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TileCrush=void 0;var i=e("../../define/TileDefine"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return i.TileAct.Crush},enumerable:!1,configurable:!0}),t}(e("../mvc/GridCmd").TilePlay);n.TileCrush=c,cc._RF.pop()},{"../../define/TileDefine":"TileDefine","../mvc/GridCmd":"GridCmd"}],TileDefine:[function(e,t,n){"use strict";cc._RF.push(t,"26803Rs0JVLDKDkgx5EFssX","TileDefine"),Object.defineProperty(n,"__esModule",{value:!0}),n.NULL_TILE=n.TileAct=n.TILE_GROUP_IS=n.NORM_TILE=n.TileType=n.TileGroup=n.TILE_H=n.TILE_W=void 0;var r,o=e("../game/mvc/model/TileModel");n.TILE_W=96,n.TILE_H=96,function(e){e[e.Norm=0]="Norm",e[e.Block=1]="Block",e[e.Item=2]="Item",e[e.Skill=3]="Skill",e[e.Enemy=4]="Enemy",e[e.Player=5]="Player",e[e.None=9]="None",e[e.Max=10]="Max"}(n.TileGroup||(n.TileGroup={})),function(e){e[e.Blue=0]="Blue",e[e.Green=1]="Green",e[e.Red=2]="Red",e[e.Yellow=3]="Yellow",e[e.Stone=100]="Stone",e[e.Rock=101]="Rock",e[e.Potion=200]="Potion",e[e.Cross=300]="Cross",e[e.Thunder=301]="Thunder",e[e.Cyclone=302]="Cyclone",e[e.Warrior=400]="Warrior",e[e.Archer=401]="Archer",e[e.Armor=402]="Armor",e[e.Hero=500]="Hero",e[e.None=999]="None"}(r=n.TileType||(n.TileType={})),n.NORM_TILE={min:r.Blue,max:r.Yellow},n.TILE_GROUP_IS=function(e){return Math.floor(e/100)},function(e){e[e.Spawn=0]="Spawn",e[e.Fall=1]="Fall",e[e.Select=2]="Select",e[e.Swap=3]="Swap",e[e.Crush=4]="Crush",e[e.Trans=5]="Trans",e[e.Wait=6]="Wait",e[e.Move=7]="Move",e[e.Slip=8]="Slip",e[e.Hit=9]="Hit",e[e.Die=10]="Die",e[e.Next=11]="Next",e[e.Skill=12]="Skill",e[e.Atk=13]="Atk",e[e.Cd=14]="Cd"}(n.TileAct||(n.TileAct={})),n.NULL_TILE=new o.TileModel(-1),cc._RF.pop()},{"../game/mvc/model/TileModel":"TileModel"}],TileDie:[function(e,t,n){"use strict";cc._RF.push(t,"26723JtucxMjow/dr2SP1Ue","TileDie");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TileDie=void 0;var i=e("../../define/TileDefine"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return i.TileAct.Die},enumerable:!1,configurable:!0}),t}(e("../mvc/GridCmd").TilePlay);n.TileDie=c,cc._RF.pop()},{"../../define/TileDefine":"TileDefine","../mvc/GridCmd":"GridCmd"}],TileFall:[function(e,t,n){"use strict";cc._RF.push(t,"d3a2eEov51PbJtErpAbA9qL","TileFall");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TileFall=void 0;var i=e("../../define/TileDefine"),c=function(e){function t(t){var n=e.call(this)||this;return n.target=null,n.target=t,n}return o(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return i.TileAct.Fall},enumerable:!1,configurable:!0}),t}(e("../mvc/GridCmd").TilePlay);n.TileFall=c,cc._RF.pop()},{"../../define/TileDefine":"TileDefine","../mvc/GridCmd":"GridCmd"}],TileHit:[function(e,t,n){"use strict";cc._RF.push(t,"81e1ds1ixlA4b+yu/2w7KVO","TileHit");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TileHit=void 0;var i=e("../../define/TileDefine"),c=function(e){function t(t){var n=e.call(this)||this;return n.damage=0,n.damage=t,n}return o(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return i.TileAct.Hit},enumerable:!1,configurable:!0}),t}(e("../mvc/GridCmd").TilePlay);n.TileHit=c,cc._RF.pop()},{"../../define/TileDefine":"TileDefine","../mvc/GridCmd":"GridCmd"}],TileModelBase:[function(e,t,n){"use strict";cc._RF.push(t,"8661bpbMbtJ2LSJ2CrpIfqc","TileModelBase"),Object.defineProperty(n,"__esModule",{value:!0}),n.TileModelBase=void 0;var r=e("../../../define/TileDefine"),o=function(){function e(t){void 0===t&&(t=e.counter),this.id=-1,this._type=r.TileType.None,this.group=r.TileGroup.Norm,this._pos={x:-1,y:-1},this.entry={x:-1,y:-1},this.id=t}return Object.defineProperty(e,"counter",{get:function(){return this._counter++},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(e){this.setType(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this._pos},set:function(e){this.setPos(e)},enumerable:!1,configurable:!0}),e.prototype.setType=function(e){this._type=e,this.group=r.TILE_GROUP_IS(this._type)},e.prototype.setPos=function(e){this._pos=Object.assign({},e),this.entry=Object.assign({},e)},e.prototype.toString=function(){var e=(Array(3).join(" ")+this.id).slice(-3),t=(Array(3).join(" ")+this.type).slice(-3);return this.type!=r.TileType.None?e+"("+t+")":"xxx(xxx)"},e._counter=0,e}();n.TileModelBase=o,cc._RF.pop()},{"../../../define/TileDefine":"TileDefine"}],TileModel:[function(e,t,n){"use strict";cc._RF.push(t,"de0633qvGpDqZK3sNBY+uLA","TileModel");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TileModel=void 0;var i=e("../../../define/GameDefine"),c=e("../../../define/TileDefine"),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.crushed=!1,t.hold=!1,t._trans=c.TileType.None,t.maxHp=0,t.currHp=0,t.cd=0,t.manage=null,t}return o(t,e),Object.defineProperty(t.prototype,"trans",{get:function(){return this._trans},set:function(e){this.setTrans(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_data",{get:function(){return i.ROLE_TABLE[this._type]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dead",{get:function(){return this.currHp<=0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"atk",{get:function(){var e;return null!==(e=this._data.atk)&&void 0!==e?e:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"def",{get:function(){var e;return null!==(e=this._data.def)&&void 0!==e?e:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dex",{get:function(){var e;return null!==(e=this._data.dex)&&void 0!==e?e:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"energy",{get:function(){var e;return null!==(e=this._data.energy)&&void 0!==e?e:0},enumerable:!1,configurable:!0}),t.prototype.clear=function(){this.crushed=!1,this._trans=c.TileType.None},t.prototype.setType=function(t){e.prototype.setType.call(this,t),this.crushed=!1,this.hold=this.group==c.TileGroup.Block,this.fullHp(),this.cooldown(),this.manage&&this.manage(this)},t.prototype.setTrans=function(e){this._trans=e,this.crushed=!1},t.prototype.nextRound=function(e){var t;void 0===e&&(e=!0),e&&(this.cd=(--this.cd).limit(0,null!==(t=this._data.cd)&&void 0!==t?t:0))},t.prototype.fullHp=function(){var e;return this.maxHp=null!==(e=this._data.hp)&&void 0!==e?e:0,this.currHp=this.maxHp,this.currHp},t.prototype.addHp=function(e){return this.currHp=(this.currHp+e).limit(0,this.maxHp),this.currHp},t.prototype.decHp=function(e){return this.currHp=(this.currHp-e).limit(0,this.maxHp),this.currHp},t.prototype.cooldown=function(){var e;return this.cd=null!==(e=this._data.cd)&&void 0!==e?e:0,this.cd},t.prototype.addCd=function(e){var t;return void 0===e&&(e=1),this.cd=(this.cd+e).limit(0,null!==(t=this._data.cd)&&void 0!==t?t:0),this.cd},t}(e("./TileModelBase").TileModelBase);n.TileModel=s,cc._RF.pop()},{"../../../define/GameDefine":"GameDefine","../../../define/TileDefine":"TileDefine","./TileModelBase":"TileModelBase"}],TileMove:[function(e,t,n){"use strict";cc._RF.push(t,"173a6QXDphOYJUrqhzom3ob","TileMove");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TileMove=void 0;var i=e("../../define/TileDefine"),c=function(e){function t(t,n){void 0===n&&(n=!1);var r=e.call(this)||this;return r.target=null,r.skip=!1,r.target=t,r.skip=n,r}return o(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return i.TileAct.Move},enumerable:!1,configurable:!0}),t}(e("../mvc/GridCmd").TilePlay);n.TileMove=c,cc._RF.pop()},{"../../define/TileDefine":"TileDefine","../mvc/GridCmd":"GridCmd"}],TileNext:[function(e,t,n){"use strict";cc._RF.push(t,"dfd93kaszhNSLWF65YNYIyt","TileNext");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TileNext=void 0;var i=e("../../define/TileDefine"),c=function(e){function t(t){void 0===t&&(t=!0);var n=e.call(this)||this;return n.dec=!0,n.dec=t,n}return o(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return i.TileAct.Next},enumerable:!1,configurable:!0}),t}(e("../mvc/GridCmd").TilePlay);n.TileNext=c,cc._RF.pop()},{"../../define/TileDefine":"TileDefine","../mvc/GridCmd":"GridCmd"}],TileSelect:[function(e,t,n){"use strict";cc._RF.push(t,"0ce15DYk5lAP5BHkUmd9wnk","TileSelect");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TileSelect=void 0;var i=e("../../define/TileDefine"),c=function(e){function t(t){var n=e.call(this)||this;return n.selected=!1,n.selected=t,n}return o(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return i.TileAct.Select},enumerable:!1,configurable:!0}),t}(e("../mvc/GridCmd").TilePlay);n.TileSelect=c,cc._RF.pop()},{"../../define/TileDefine":"TileDefine","../mvc/GridCmd":"GridCmd"}],TileSkill:[function(e,t,n){"use strict";cc._RF.push(t,"c3ecfPnyZtB1IvOe0ohudrD","TileSkill");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TileSkill=void 0;var i=e("../../define/TileDefine"),c=function(e){function t(t){var n=e.call(this)||this;return n.eff=i.TileType.None,n.eff=t,n}return o(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return i.TileAct.Skill},enumerable:!1,configurable:!0}),t}(e("../mvc/GridCmd").TilePlay);n.TileSkill=c,cc._RF.pop()},{"../../define/TileDefine":"TileDefine","../mvc/GridCmd":"GridCmd"}],TileSlip:[function(e,t,n){"use strict";cc._RF.push(t,"edde108FNBN1aZbMwD8dxhn","TileSlip");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TileSlip=void 0;var i=e("../../define/TileDefine"),c=function(e){function t(t){var n=e.call(this)||this;return n.path=[],n.path=n.path.concat(t),n}return o(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return i.TileAct.Slip},enumerable:!1,configurable:!0}),t}(e("../mvc/GridCmd").TilePlay);n.TileSlip=c,cc._RF.pop()},{"../../define/TileDefine":"TileDefine","../mvc/GridCmd":"GridCmd"}],TileSpawn:[function(e,t,n){"use strict";cc._RF.push(t,"ae52abFu7RJMYTi1a09cpxX","TileSpawn");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TileSpawn=void 0;var i=e("../../define/TileDefine"),c=function(e){function t(t){void 0===t&&(t=!1);var n=e.call(this)||this;return n.skip=!1,n.skip=t,n}return o(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return i.TileAct.Spawn},enumerable:!1,configurable:!0}),t}(e("../mvc/GridCmd").TilePlay);n.TileSpawn=c,cc._RF.pop()},{"../../define/TileDefine":"TileDefine","../mvc/GridCmd":"GridCmd"}],TileSwap:[function(e,t,n){"use strict";cc._RF.push(t,"305eb9/uFVFt7PwwQrQpdoG","TileSwap");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TileSwap=void 0;var i=e("../../define/TileDefine"),c=function(e){function t(t){var n=e.call(this)||this;return n.target=null,n.target=t,n}return o(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return i.TileAct.Swap},enumerable:!1,configurable:!0}),t}(e("../mvc/GridCmd").TilePlay);n.TileSwap=c,cc._RF.pop()},{"../../define/TileDefine":"TileDefine","../mvc/GridCmd":"GridCmd"}],TileTrans:[function(e,t,n){"use strict";cc._RF.push(t,"742f808Xg5MsIylfMVf7TPM","TileTrans");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TileTrans=void 0;var i=e("../../define/TileDefine"),c=function(e){function t(t,n){void 0===n&&(n=!1);var r=e.call(this)||this;return r.target=null,r.skip=!1,r.target=t,r.skip=n,r}return o(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return i.TileAct.Trans},enumerable:!1,configurable:!0}),t}(e("../mvc/GridCmd").TilePlay);n.TileTrans=c,cc._RF.pop()},{"../../define/TileDefine":"TileDefine","../mvc/GridCmd":"GridCmd"}],TileView:[function(e,t,n){"use strict";cc._RF.push(t,"2b049TUbiZK+4ESEXmNP/a7","TileView");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.TileView=void 0;var u=e("../../../cfg/EventCfg"),a=e("../../../cfg/SpinCfg"),l=e("../../../cfg/TextureCfg"),p=e("../../../comm/asset/AssetMgr"),f=e("../../../comm/cmpt/Spine"),h=e("../../../comm/event/EventMgr"),d=e("../../../comm/util/WaitUtil"),y=e("../../../define/TileDefine"),_=e("../model/TileModel"),m=cc._decorator,v=m.ccclass,b=m.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._model=new _.TileModel(-1),t.avatar=null,t.info=null,t.bar=null,t.spine=null,t.anim=null,t.cooldown=null,t}return o(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._model.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._model.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"group",{get:function(){return this._model.group},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cd",{set:function(e){var t;this.cooldown.string=null!==(t=null==e?void 0:e.toString())&&void 0!==t?t:"0"},enumerable:!1,configurable:!0}),t.prototype.onDestroy=function(){this._model=null},t.prototype.clear=function(){this.avatar.node.active=!0,this.spine.stop(),this.spine.scale(1),this.spine.node.active=!1,this.anim.stop(),this.anim.node.active=!1},t.prototype.init=function(e){return c(this,void 0,Promise,function(){var t;return s(this,function(n){switch(n.label){case 0:return t=e.id.toString(),this.node.name=t,this.info.string=t,this.bar.node.active=!1,Object.assign(this._model,e),this.node.x=y.TILE_W*(e.entry.x+.5),this.node.y=y.TILE_H*(e.entry.y+.5),this.spine&&(this.spine.node.active=!1),[4,this.setType(e.type)];case 1:return n.sent(),[2]}})})},t.prototype.setType=function(e){return c(this,void 0,Promise,function(){var t,n,r,o,i;return s(this,function(c){switch(c.label){case 0:return this._model.type=e,e==y.TileType.None?[3,4]:(t=l.TextureSrc[y.TileType[e]],n=this.avatar,[4,p.AssetMgr.inst().loadAsset(t,cc.SpriteFrame,!0)]);case 1:return n.spriteFrame=c.sent(),this.node.zIndex=this.group,this.spine?this.group!=y.TileGroup.Norm&&this.group!=y.TileGroup.Player?[3,3]:(r=a.SpineSrc[y.TileType[e]],i=(o=this.spine).init,[4,p.AssetMgr.inst().loadAsset(r,sp.SkeletonData,!0)]):[3,3];case 2:i.apply(o,[c.sent()]),c.label=3;case 3:this.cooldown.node.active=this.group==y.TileGroup.Player||this.group==y.TileGroup.Enemy,this.cd=this._model.cd,c.label=4;case 4:return[4,this.setBar()];case 5:return c.sent(),[2]}})})},t.prototype.setBar=function(){return c(this,void 0,Promise,function(){var e,t;return s(this,function(n){switch(n.label){case 0:return(e=this.group==y.TileGroup.Player?l.TextureSrc.PlayerHp:this.group==y.TileGroup.Enemy?l.TextureSrc.EnemyHp:null)?(t=this.bar.barSprite,[4,p.AssetMgr.inst().loadAsset(e,cc.SpriteFrame,!0)]):[3,2];case 1:t.spriteFrame=n.sent(),this.refreshBar(),n.label=2;case 2:return this.bar.node.active=null!=e,[2]}})})},t.prototype.refreshBar=function(){this.bar.progress=this._model.currHp/this._model.maxHp},t.prototype.decHp=function(e){this._model.decHp(e),this.refreshBar(),this.refreshBlock(),this._model.group==y.TileGroup.Player&&this._model.currHp<=0&&h.EventMgr.inst().emit(u.EventSrc.Lose)},t.prototype.refreshBlock=function(){return c(this,void 0,Promise,function(){var e,t,n;return s(this,function(r){switch(r.label){case 0:return this._model.group!=y.TileGroup.Block?[3,3]:(e=this._model.currHp,(t=1==e?l.TextureSrc.Stone:2==e?l.TextureSrc.Rock:null)?(n=this.avatar,[4,p.AssetMgr.inst().loadAsset(t,cc.SpriteFrame,!0)]):[3,2]);case 1:n.spriteFrame=r.sent(),r.label=2;case 2:r.label=3;case 3:return[2]}})})},t.prototype.nextRound=function(e){void 0===e&&(e=!0),this._model.nextRound(e),this.cd=this._model.cd},t.prototype.hit=function(){var e,t;return c(this,void 0,Promise,function(){var n,r,o,i=this;return s(this,function(c){switch(c.label){case 0:return n=this,this.group!=y.TileGroup.Enemy?[3,2]:((r=function(e){n.avatar.node.active=!e,n.anim&&(i.anim.node.active=e)})(!0),null===(e=this.anim)||void 0===e||e.play(y.TileType[this.type]+"Hit"),[4,d.WaitUtil.waitMs(800)]);case 1:return c.sent(),null===(t=this.anim)||void 0===t||t.stop(),r(!1),[3,3];case 2:(o=cc.tween(this.avatar.node)).to(.1,{color:cc.Color.RED}),o.to(.1,{color:cc.Color.WHITE}),o.start(),c.label=3;case 3:return[2]}})})},t.prototype.die=function(){return c(this,void 0,Promise,function(){return s(this,function(){return this.group==y.TileGroup.Enemy&&h.EventMgr.inst().emit(u.EventSrc.Crushed,this.type,1),this._model.energy>0&&h.EventMgr.inst().emit(u.EventSrc.Charge,this._model.energy),[2]})})},t.prototype.select=function(e){var t=this,n=function(e){t.avatar.node.active=!e,t.spine.node.active=e};switch(this.group){case y.TileGroup.Norm:n(!0),e?t.spine.playLoop("Idle"):"Idle"==t.spine.key&&(t.spine.stop(),n(!1));break;case y.TileGroup.Player:n(!0),e?t.spine.playOnce("WinFreeGame").then(function(){t.spine.playLoop("AnticipationLoop")}):"WinFreeGame"!=t.spine.key&&"AnticipationLoop"!=t.spine.key||(t.spine.stop(),n(!1))}},t.prototype.atk=function(){var e,t;return c(this,void 0,Promise,function(){var n,r,o=this;return s(this,function(i){switch(i.label){case 0:return n=this,this.group!=y.TileGroup.Enemy?[3,2]:((r=function(e){n.avatar.node.active=!e,n.anim&&(o.anim.node.active=e)})(!0),null===(e=this.anim)||void 0===e||e.play(y.TileType[this.type]+"Atk"),[4,d.WaitUtil.waitMs(800)]);case 1:i.sent(),null===(t=this.anim)||void 0===t||t.stop(),r(!1),i.label=2;case 2:return[2]}})})},t.prototype.walk=function(){var e,t;return c(this,void 0,Promise,function(){var n,r,o=this;return s(this,function(i){switch(i.label){case 0:return n=this,this.group!=y.TileGroup.Enemy?[3,2]:((r=function(e){n.avatar.node.active=!e,n.anim&&(o.anim.node.active=e)})(!0),null===(e=this.anim)||void 0===e||e.play(y.TileType[this.type]+"Walk"),[4,d.WaitUtil.waitMs(800)]);case 1:i.sent(),null===(t=this.anim)||void 0===t||t.stop(),r(!1),i.label=2;case 2:return[2]}})})},t.prototype.crushed=function(){this.group==y.TileGroup.Norm&&(!0,this.avatar.node.active=!1,this.spine.node.active=!0,this.spine.playOnce("Win").then(function(){}))},t.prototype.doCooldown=function(){this.cd=this._model.cooldown()},i([b(cc.Sprite)],t.prototype,"avatar",void 0),i([b(cc.Label)],t.prototype,"info",void 0),i([b(cc.ProgressBar)],t.prototype,"bar",void 0),i([b(f.Spine)],t.prototype,"spine",void 0),i([b(cc.Animation)],t.prototype,"anim",void 0),i([b(cc.Label)],t.prototype,"cooldown",void 0),i([v],t)}(cc.Component);n.TileView=g,cc._RF.pop()},{"../../../cfg/EventCfg":"EventCfg","../../../cfg/SpinCfg":"SpinCfg","../../../cfg/TextureCfg":"TextureCfg","../../../comm/asset/AssetMgr":"AssetMgr","../../../comm/cmpt/Spine":"Spine","../../../comm/event/EventMgr":"EventMgr","../../../comm/util/WaitUtil":"WaitUtil","../../../define/TileDefine":"TileDefine","../model/TileModel":"TileModel"}],TileWait:[function(e,t,n){"use strict";cc._RF.push(t,"e37c4LzOuBLlabsD+PHRT8N","TileWait");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TileWait=void 0;var i=e("../../define/TileDefine"),c=function(e){function t(t){var n=e.call(this)||this;return n.time=0,n.time=t,n}return o(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return i.TileAct.Wait},enumerable:!1,configurable:!0}),t}(e("../mvc/GridCmd").TilePlay);n.TileWait=c,cc._RF.pop()},{"../../define/TileDefine":"TileDefine","../mvc/GridCmd":"GridCmd"}],UIBase:[function(e,t,n){"use strict";cc._RF.push(t,"0d6281lIZdApZ5eFxiUAQkN","UIBase");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.UIBase=void 0;var u=cc._decorator,a=u.ccclass,l=(u.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.show=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return c(this,void 0,Promise,function(){return s(this,function(){return this.node.active=!0,[2]})})},t.prototype.hide=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return c(this,void 0,Promise,function(){return s(this,function(){return this.node.active=!1,[2]})})},i([a],t)}(cc.Component));n.UIBase=l,cc._RF.pop()},{}],UltAtk:[function(e,t,n){"use strict";cc._RF.push(t,"40202/RgDdJ6oe2meoBti+n","UltAtk");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.UltAtk=void 0;var s=e("../../../comm/util/WorkChain"),u=e("../../../define/GameDefine"),a=e("../../act/TileDie"),l=e("../../act/TileHit"),p=e("../../mvc/GridCmd"),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.business=function(e){return i(this,void 0,Promise,function(){var t;return c(this,function(){return t=new p.GridCmd,e.model.enemies.forEach(function(n){if(!(n.id<0||e.model.getTile(n.pos).id!=n.id)){var r=(u.ULT_DAMAGE-n.def).limit(1,u.ULT_DAMAGE);t.add(n,new l.TileHit(r)),n.decHp(r),cc.log("$\u5927\u62db"+n.id+", \u50b7\u5bb3"+r+", \u5269\u8840"+n.currHp,n.pos,n.type),n.decHp(r)<=0&&(n.currHp<=0&&t.add(n,new a.TileDie),e.model.setTile(n.pos,null),cc.log(n.id+"\u6b7b\u4ea1",n.pos))}}),t.deed.size>0&&e.load.push(t),[2,!0]})})},t}(s.WorkChain);n.UltAtk=f,cc._RF.pop()},{"../../../comm/util/WorkChain":"WorkChain","../../../define/GameDefine":"GameDefine","../../act/TileDie":"TileDie","../../act/TileHit":"TileHit","../../mvc/GridCmd":"GridCmd"}],UltView:[function(e,t,n){"use strict";cc._RF.push(t,"eb877LJj4dLRaakjapoCfve","UltView");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.UltView=void 0;var c=e("../../../cfg/EventCfg"),s=e("../../../comm/cmpt/ReplayFx"),u=e("../../../comm/cmpt/Shake"),a=e("../../../comm/event/EventDecor"),l=e("../../../comm/event/EventMgr"),p=e("../../../comm/util/WaitUtil"),f=e("../../../define/GameDefine"),h=e("../ctrl/GridCtrl"),d=cc._decorator,y=d.ccclass,_=d.property,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bar=null,t.btn=null,t._energy=0,t.btnsfx=null,t.ultSfx=null,t.shake=null,t._color=cc.Color.GRAY,t}return o(t,e),t.prototype.onLoad=function(){this.clear()},t.prototype.clear=function(){var e;this._energy=0,this.bar.progress=0,this.btn.target.color=cc.Color.GRAY,this._color=this.btn.target.color,null===(e=this.btnsfx)||void 0===e||e.stop()},t.prototype.charge=function(e){var t;this._energy=(this._energy+e).limit(0,f.MAX_ENERGY),this.bar.progress=this._energy/f.MAX_ENERGY,this._energy>=f.MAX_ENERGY&&(h.GridCtrl.inst.playing?this._color=cc.Color.WHITE:(this.btn.target.color=cc.Color.WHITE,this._color=this.btn.target.color),null===(t=this.btnsfx)||void 0===t||t.play())},t.prototype.onClick=function(){var e,t=this;h.GridCtrl.inst.playing||this._energy>=f.MAX_ENERGY&&(this.clear(),null===(e=this.ultSfx)||void 0===e||e.play(),p.WaitUtil.waitMs(900,this).then(function(){var e;null===(e=t.shake)||void 0===e||e.play(600)}),window.setTimeout(function(){var e;l.EventMgr.inst().emit(c.EventSrc.Ultimate),null===(e=t.shake)||void 0===e||e.stop()},2e3))},t.prototype.playing=function(e){this.btn.target.color=e?cc.Color.GRAY:this._color},i([_(cc.ProgressBar)],t.prototype,"bar",void 0),i([_(cc.Button)],t.prototype,"btn",void 0),i([_(s.ReplayFx)],t.prototype,"btnsfx",void 0),i([_(s.ReplayFx)],t.prototype,"ultSfx",void 0),i([_(u.Shake)],t.prototype,"shake",void 0),i([a.onEvent(c.EventSrc.Charge)],t.prototype,"charge",null),i([a.onEvent(c.EventSrc.Playing)],t.prototype,"playing",null),i([y,a.onEnable()],t)}(cc.Component);n.UltView=m,cc._RF.pop()},{"../../../cfg/EventCfg":"EventCfg","../../../comm/cmpt/ReplayFx":"ReplayFx","../../../comm/cmpt/Shake":"Shake","../../../comm/event/EventDecor":"EventDecor","../../../comm/event/EventMgr":"EventMgr","../../../comm/util/WaitUtil":"WaitUtil","../../../define/GameDefine":"GameDefine","../ctrl/GridCtrl":"GridCtrl"}],WaitUtil:[function(e,t,n){"use strict";cc._RF.push(t,"2e4aahn2utFXr4HtKpGXAFG","WaitUtil");var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.WaitUtil=void 0;var i=function(){function e(){}return e.waitMs=function(e,t){return r(this,void 0,Promise,function(){return o(this,function(n){switch(n.label){case 0:return t?[4,this.waitSec(e/1e3,t)]:[3,2];case 1:return n.sent(),[3,4];case 2:return[4,new Promise(function(t){return window.setTimeout(t,e)})];case 3:n.sent(),n.label=4;case 4:return[2]}})})},e.waitSec=function(e,t){return r(this,void 0,Promise,function(){return o(this,function(n){switch(n.label){case 0:return t?[4,new Promise(function(n){return t.scheduleOnce(n,e)})]:[3,2];case 1:return n.sent(),[3,4];case 2:return[4,this.waitMs(1e3*e)];case 3:n.sent(),n.label=4;case 4:return[2]}})})},e}();n.WaitUtil=i,cc._RF.pop()},{}],WidgetAdapt:[function(e,t,n){"use strict";cc._RF.push(t,"34c5eicTu5AhbJ6bPWBa3tJ","WidgetAdapt");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.WidgetAdapt=void 0;var c=e("../../../cfg/EventCfg"),s=e("../../event/EventDecor"),u=cc._decorator,a=u.ccclass,l=(u.property,u.menu),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onLoad=function(){this.adjust()},t.prototype.adjust=function(){this.node.setContentSize(cc.Canvas.instance.designResolution);var e=this.node.width,t=this.node.height,n=cc.view.getCanvasSize(),r=Math.min(n.width/e,n.height/t),o=e*r,i=t*r;this.node.width*=n.width/o,this.node.height*=n.height/i},i([s.onEvent(c.EventSrc.Resize)],t.prototype,"adjust",null),i([a,l("adapt/widget"),s.onEnable()],t)}(cc.Component);n.WidgetAdapt=p,cc._RF.pop()},{"../../../cfg/EventCfg":"EventCfg","../../event/EventDecor":"EventDecor"}],WinView:[function(e,t,n){"use strict";cc._RF.push(t,"20e41aLJ4dFAYMz+LRcQmSa","WinView");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.WinView=void 0;var u=e("../../../cfg/AudioCfg"),a=e("../../../comm/asset/AssetMgr"),l=e("../../../comm/audio/BgmAudio"),p=e("../../../comm/audio/SfxAudio"),f=e("../../../comm/cmpt/Spine"),h=e("../../../comm/util/WaitUtil"),d=cc._decorator,y=d.ccclass,_=d.property,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.win=null,t}return o(t,e),t.prototype.onLoad=function(){this.node.active=!1,this.node.x=0},t.prototype.play=function(){return c(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return this.node.active=!0,a.AssetMgr.inst().loadAsset(u.AudioSrc.Win,cc.AudioClip,!0).then(function(e){l.BgmAudio.inst().pause(),p.SfxAudio.inst().play(e,function(){return l.BgmAudio.inst().resume()})}),[4,this.win.playOnce("LegendWin")];case 1:return e.sent(),this.win.playLoop("LegendWinLoop"),[4,h.WaitUtil.waitSec(2.5)];case 2:return e.sent(),this.node.active=!1,[2]}})})},i([_(f.Spine)],t.prototype,"win",void 0),i([y],t)}(cc.Component);n.WinView=m,cc._RF.pop()},{"../../../cfg/AudioCfg":"AudioCfg","../../../comm/asset/AssetMgr":"AssetMgr","../../../comm/audio/BgmAudio":"BgmAudio","../../../comm/audio/SfxAudio":"SfxAudio","../../../comm/cmpt/Spine":"Spine","../../../comm/util/WaitUtil":"WaitUtil"}],WorkChain:[function(e,t,n){"use strict";cc._RF.push(t,"8cb28vigJ9BGpjOomy/kS+Q","WorkChain");var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,s)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.WorkChain=void 0;var i=function(){function e(){this._next=null}return e.prototype.push=function(e){return this._next?this._next.push(e):(this._next=e,this)},e.prototype.insert=function(e){return e._next=this._next,this._next=e,e},e.prototype.execute=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(this,void 0,Promise,function(){var t,n;return o(this,function(r){switch(r.label){case 0:return[4,this.business.apply(this,e)];case 1:return r.sent()?this._next?[4,(n=this._next).execute.apply(n,e)]:[3,3]:[3,5];case 2:return t=r.sent(),[3,4];case 3:t=!0,r.label=4;case 4:return[2,t];case 5:return[2,!1]}})})},e}();n.WorkChain=i,cc._RF.pop()},{}]},{},["AudioCfg","EventCfg","PrefabCfg","SpinCfg","TextureCfg","AssetLoader","AssetMgr","BgmAudio","SfxAudio","ReplayFx","Shake","Spine","CanvasAdapt","DesktopAdapt","WidgetAdapt","DutyUI","UIBase","EventDecor","EventMgr","NumExtend","StrExtend","CmptPool","ObjPool","DataDriven","RandUtil","SaveUtil","SimulateFx","Singleton","WaitUtil","WorkChain","DebugPnl","DebugTool","GameDefine","GridDefine","TileDefine","GameMgr","Loading","TileAtk","TileCd","TileCrush","TileDie","TileFall","TileHit","TileMove","TileNext","TileSelect","TileSkill","TileSlip","TileSpawn","TileSwap","TileTrans","TileWait","GridCmd","GridDirector","GridCtrl","GridCtrlBase","StageCtrl","GridModel","GridModelBase","StageModel","TileModel","TileModelBase","GridView","LoseView","RuleView","SfxView","StageView","TileView","UltView","WinView","SelectHandler","ComboWork","CrushWork","DropWork","ResetWork","SlipWork","StuffWork","EnemyAtk","EnemyWalk","NormAtk","SkillAtk","UltAtk","FirstCheck","LimitCheck","MoveCheck","SecondCheck","SwapCheck","EnemyPort","NormPort","PlayerPort","SkillPort","RecBtnUI","RecUI","RuleBtnUI","RuleUI"]);